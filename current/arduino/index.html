<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --><!-- 20111122 0939 --><link rel="stylesheet" href="/docs/assets/css/main.css">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --><!-- WARNING: Respond.js doesn't work if you view the page via file:// --><!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]--><script>

    var site = {
      baseurl: '/docs',
      local: (document.location.port || document.location.protocol === 'file:')
    };

    (function(canonical) {
      if (!site.local && document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/current/arduino/');

    </script><!-- Begin Jekyll SEO tag v2.1.0 --><title>Arduino - The Things Network</title>
<meta property="og:title" content="Arduino">
<meta name="description" content="Arduino is an open-source electronics platform based on easy-to-use hardware and software. It’s intended for anyone making interactive projects.">
<meta property="og:description" content="Arduino is an open-source electronics platform based on easy-to-use hardware and software. It’s intended for anyone making interactive projects.">
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/current/arduino/">
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/current/arduino/">
<meta property="og:site_name" content="The Things Network">
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-12-05T12:36:30+00:00">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@thethingsnetwrk">
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork">
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Arduino",
"image": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png",
"datePublished": "2016-12-05T12:36:30+00:00",
"description": "Arduino is an open-source electronics platform based on easy-to-use hardware and software. It’s intended for anyone making interactive projects.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png"}},
"url": "https://www.thethingsnetwork.org/docs/current/arduino/"}</script><!-- End Jekyll SEO tag --><link rel="apple-touch-icon-precomposed" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png">
<meta name="application-name" content="The Things Network">
<meta name="msapplication-tooltip" content="Building a Global Internet of Things Network Together.">
<meta name="msapplication-config" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/ieconfig.xml">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-32.png" sizes="32x32">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-57.png" sizes="57x57">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-76.png" sizes="76x76">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-96.png" sizes="96x96">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-120.png" sizes="120x120">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-128.png" sizes="128x128">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png" sizes="144x144">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png" sizes="152x152">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-180.png" sizes="180x180">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-195.png" sizes="195x195">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-228.png" sizes="228x228">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/smalltile.png" sizes="128x128">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/mediumtile.png" sizes="270x270">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/widetile.png" sizes="558x270">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png" sizes="558x558">
<link rel="shortcut icon" sizes="196x196" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-196.png">
</head>
<body>

    <div id="content">
      










<div id="top" class="layout-guide container">

  <div class="row guide-nav">
    <div class="col-sm-9">
      <ol class="breadcrumb">
<li><a href="http://www.thethingsnetwork.org/">Home</a></li>
        <li><a href="/docs/">Learn</a></li>
        
        <li class="active">Arduino</li>
      </ol>
</div>
    <div class="col-sm-3 text-right">
      <a class="btn btn-default hidden-xs" href="http://github.com/TheThingsNetwork/docs/edit/master/_includes/current/arduino.md" target="_blank"><i class="fa fa-pencil"></i> Improve this guide</a>
    </div>
  </div>

  <div class="row">

    <div class="col-md-3" role="complementary">

      <div class="guide-switch btn-group btn-block">
        <button type="button" class="btn btn-primary btn-block dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Guides <span class="caret"></span></button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<li class="disabled"><a href="#">
              
              The Things Node
              
              </a></li>
            
              
                <li><a href="/docs/current/uno/">
              
              The Things Uno
              
              </a></li>
            
              
                <li class="active"><a href="/docs/current/arduino/">
              
              Arduino
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Devices
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li class="disabled"><a href="#">
              
              The Things Gateway
              
              </a></li>
            
              
                <li><a href="/docs/current/multitech/">
              
              MultiTech Conduit
              
              </a></li>
            
              
                <li><a href="/docs/current/lorrier/">
              
              Lorrier LR2
              
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Gateways
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li><a href="/docs/current/dashboard/">
              
              The Things Dashboard
              
              </a></li>
            
              
                <li><a href="/docs/current/cli/">
              
              The Things CLI
              
              </a></li>
            
              
                <li><a href="https://www.thethingsnetwork.org/wiki/Backend/Overview">
              
              Architecture
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li><a href="/docs/current/mqtt/">
              
              MQTT
              <span class="label label-info">API</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-js/">
              
              Node.js
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-red/">
              
              Node-RED
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/v2-preview/java/">
              
              Java
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Platforms
              
              </a></li>
            
          
        </ul>
</div>

      <div class="guide-sidebar hidden-xs hidden-sm">

        <div class="js-toc"></div>

        <p class="guide-top"><a href="#top">Back to top</a></p>

      </div>

    </div>

    <div class="col-md-9 js-toc-content content-body" role="main">

      

      
      

      <section class="panel"><div class="panel-body">
          <span class="label label-success pull-right">CURRENT: V1-STAGING</span>
          <h1>Arduino</h1>
          <p><a href="https://www.arduino.cc/en/Guide/Introduction">Arduino</a> is an open-source electronics platform based on easy-to-use hardware and software. It’s intended for anyone making interactive projects.</p>

<p>With <a href="https://github.com/thethingsnetwork/arduino-device-lib">The Things Network Library</a> Arduino Boards can communicate via The Things Network. Both <a href="/docs/current/uno/">The Things Uno</a> and The Things Node are Arduino Boards that include a LoRaWAN module.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Access to <a href="https://staging.thethingsnetwork.org/">staging.thethingsnetwork.org</a>.</li>
  <li>Arduino board with <a href="http://www.microchip.com/design-centers/wireless-connectivity/embedded-wireless/lora-technology">Microchip RN2xx3 module</a> for LoRaWAN.</li>
  <li>Version 0.x of the <a href="https://github.com/thethingsnetwork/arduino-device-lib">The Things Network Arduino Library</a>.</li>
</ul>
<blockquote>
  <p>Since version 0.17, the library now has its <a href="https://github.com/thethingsnetwork/arduino-device-lib">own repository</a>, can be installed via the <a href="https://www.arduino.cc/en/Guide/Libraries#toc3">Library Manager</a> and has been renamed from <code class="highlighter-rouge">TheThingsUno</code> to <code class="highlighter-rouge">TheThingsNetwork</code>. I guess it should have been bumped to 1.x - oops! 😝</p>
</blockquote>

        </div>
        
          <div class="panel-footer">
            Versions:    
            
              <a href="/docs/current/arduino/" class="label label-success">CURRENT: V1-STAGING</a>
            
            
              
              
            
              
              
                <a href="/docs/v2-preview/arduino/" class="label label-default">V2-PREVIEW</a>
              
            
          </div>
        
      </section><section class="panel"><div class="panel-body">
            <h1 id="arduino-software-ide">Arduino Software (IDE)</h1>

<p>We’ll not reproduce the <a href="https://www.arduino.cc/en/Guide/Environment#toc1">Arduino Software Guide</a> here, but here’s how you install the Arduino IDE, The Things Network library and perform some common tasks that we will refer to later.</p>

<h2 id="setup">Setup</h2>

<p>Setup the Arduino IDE and The Things Network library.</p>

<ol>
<li>
<a href="https://www.arduino.cc/en/Main/Software">Download</a> and install the latest Arduino Software (IDE).</li>
  <li>Navigate to <strong>Sketch &gt; Include Library &gt; Manage Libraries…</strong>.</li>
  <li>Search for <strong>TheThingsNetwork</strong> and click the result to select it.</li>
  <li>Click the <strong>Install</strong> button which should appear:</li>
</ol>
<p><img src="arduino_library.png" alt="Library Manager"></p>

<p>The Arduino IDE will notify you of updates for the IDE and library automagically. <img class="emoji" title=":open_mouth:" alt=":open_mouth:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f62e.png" height="20" width="20" align="absmiddle"></p>

<h2 id="monitor-logs">Monitor logs</h2>

<p>Most sketches write debug logs to the (emulated) Serial Port for the USB connection. You can monitor these logs via the Arduino IDE’s Serial Monitor.</p>

<ol>
<li>Make sure <strong>Tools &gt; Port &gt; … (Arduino ..)</strong> is selected.</li>
  <li>Select <strong>Tools &gt; Serial Monitor</strong> <code class="highlighter-rouge">Ctrl/⌘ Shift M</code>.</li>
</ol>
<blockquote>
  <p>Uploads might fail if you have the monitor open. Close it and try again. Visa versa an upload might break the monitor. Make sure the right port is still selected and re-open the monitor.</p>
</blockquote>

<p>You will only see logs from the moment when you opened the Serial Monitor. Use <a href="https://www.arduino.cc/en/Reference/Delay"><code class="highlighter-rouge">delay()</code></a> to give yourself some time or even wait for the Serial Monitor completely:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#define debugSerial Serial
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  
  <span class="c1">// wait 5 seconds
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
  
  <span class="c1">// or wait for monitor
</span>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">debugSerial</span><span class="p">);</span>

  <span class="c1">// your setup
</span><span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>Be aware that if you wait for the monitor your sketch will only run after opening the monitor. Connecting it to a USB power adapter or bank will not work.</p>
</blockquote>

<h2 id="verify--upload-sketches">Verify &amp; Upload sketches</h2>

<p>When you upload a sketch to your Arduino it will first compile and fail if your sketch has errors. If there are no errors it will continue to upload.</p>

<ol>
<li>Make sure <strong>Tools &gt; Port &gt; … (Arduino ..)</strong> is selected.</li>
  <li>Select <strong>Sketch &gt; Upload</strong> <code class="highlighter-rouge">Ctrl/⌘ U</code> to compile and upload your sketch.</li>
  <li>
    <p>The Arduino IDE will give feedback which should look like:</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code> Sketch uses 9,656 bytes (33%) of program storage space. Maximum is 28,672 bytes.
 Global variables use 1,253 bytes (48%) of dynamic memory, leaving 1,307 bytes for local variables. Maximum is 2,560 bytes.
</code></pre>
    </div>
  </li>
</ol>
<blockquote>
  <p>Uploads might fail if you have the monitor open. Close it and try again.</p>
</blockquote>

<h3 id="verify-only">Verify only</h3>

<p>You can also compile your code without uploading to verify it has no errors:</p>

<ul>
<li>Select <strong>Sketch &gt; Verify/Compile</strong> <code class="highlighter-rouge">Ctrl/⌘ R</code> to check your sketch for errors.</li>
</ul>
</div>
        </section><section class="panel"><div class="panel-body">
            <h1 id="library-usage">Library Usage</h1>
<p>Here’s how you include and use The Things Network library.</p>

<h2 id="include">Include</h2>

<p>To use the library:</p>

<ol>
<li>Follow <a href="#setup">setup</a> to install the library in Arduino IDE.</li>
  <li>
    <p>Select <strong>Sketch &gt; Include Library &gt; TheThingsNetwork</strong> to include it.</p>

    <p>Or simply copy and paste:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span></code></pre>
    </div>
  </li>
</ol>
<h2 id="initialize">Initialize</h2>

<p>Your sketch will have the following template:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span>
<span class="c1">// OTAA or ABP keys
// ..
</span>
<span class="cp">#define loraSerial Serial1
#define debugSerial Serial
</span>
<span class="n">TheThingsNetwork</span> <span class="n">ttn</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">loraSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">57600</span><span class="p">);</span>

  <span class="n">ttn</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">loraSerial</span><span class="p">,</span> <span class="n">debugSerial</span><span class="p">);</span>
  <span class="n">ttn</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>

  <span class="c1">// OTAA or ABP activation
</span>  <span class="c1">// ..
</span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Send and receive messages
</span>  <span class="c1">// ..
</span><span class="p">}</span>
</code></pre>
</div>

<p>The actual streams you’d pass to <code class="highlighter-rouge">ttn.init()</code> depend on the board you use and the Serial Port you connected a LoRaWAN module to. For The Things Uno and Node use the Serial Ports and baud rates from the template.</p>

<h2 id="activate">Activate</h2>

<p>In the <a href="https://www.arduino.cc/en/Reference/setup"><code class="highlighter-rouge">setup()</code></a> function, after initializing the library, we have to activate the device.</p>

<p>There are two ways to activate your device.</p>

<h3 id="over-the-air-activation-otaa">Over The Air Activation (OTAA)</h3>

<p>For OTAA you will use the <code class="highlighter-rouge">join()</code> method with the <strong>App EUI</strong> and <strong>App Key</strong> configured for your device.</p>

<ol>
<li>
    <p>Right after the include for the library create constants to hold the keys:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="k">const</span> <span class="n">byte</span> <span class="n">appEui</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0xB3</span><span class="p">,</span> <span class="mh">0xD5</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x4A1</span><span class="p">};</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">appKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">};</span>
</code></pre>
    </div>

    <ul>
<li>For <code class="highlighter-rouge">appEui</code> use the <strong>App EUI</strong> found on the application’s page on the dashboard. Click <i class="ion-code"></i> to toggle to the <strong>msb</strong> format and then <i class="ion-clipboard"></i> to copy.</li>
      <li>For <code class="highlighter-rouge">appKey</code> use the <strong>App Key</strong> found on the device’s page under the application. Click <i class="ion-code"></i> to toggle to the <strong>msb</strong> format. You’ll have to click <i class="ion-eye"></i> to show the key before you can copy it.</li>
    </ul>
</li>
  <li>
    <p>In your <code class="highlighter-rouge">setup()</code> function, right after you have called <code class="highlighter-rouge">ttn.init()</code> and <code class="highlighter-rouge">ttn.reset()</code> call <code class="highlighter-rouge">ttn.join()</code> with the constants you just created:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">ttn</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">appEui</span><span class="p">,</span> <span class="n">appKey</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
</ol>
<p>Your device will now try to activate via OTAA every 10 seconds until it succeeds.</p>

<h3 id="activation-by-personalization-abp">Activation By Personalization (ABP)</h3>

<p>For ABP you will use the <code class="highlighter-rouge">personalize()</code> method with the device’s <strong>Dev EUI</strong>, <strong>Network Session Key</strong> and <strong>App Session Key</strong>.</p>

<ol>
<li>
    <p>Right after the include for the library create constants to hold the keys:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="k">const</span> <span class="n">byte</span> <span class="n">devAddr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">nwkSKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">};</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">appSKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">};</span>
</code></pre>
    </div>

    <ul>
<li>For <code class="highlighter-rouge">devAddr </code> use the <strong>Dev Address</strong> found on the device’s page on the dashboard. Click <i class="ion-code"></i> to toggle to the <strong>msb</strong> format and then <i class="ion-clipboard"></i> to copy.</li>
      <li>For <code class="highlighter-rouge">nwkSKey </code> use the <strong>Network Session Key</strong>. Click <i class="ion-code"></i> to toggle to the <strong>msb</strong> format. You’ll have to click <i class="ion-eye"></i> to show the key before you can copy it.</li>
      <li>For <code class="highlighter-rouge">appSKey</code> use <strong>App Session Key</strong>.</li>
    </ul>
</li>
  <li>
    <p>In your <code class="highlighter-rouge">setup()</code> function, right after you have called <code class="highlighter-rouge">ttn.init()</code> and <code class="highlighter-rouge">ttn.reset()</code> call <code class="highlighter-rouge">ttn.personalize()</code> with the constants you just created:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">ttn</span><span class="p">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">devAddr</span><span class="p">,</span> <span class="n">nwkSKey</span><span class="p">,</span> <span class="n">appSKey</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
</ol>
<p>Your device will now report to the network using these keys.</p>

<h2 id="send">Send</h2>

<p>To send messages call <code class="highlighter-rouge">ttn.sendBytes()</code> with an array of bytes and the size:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">byte</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">};</span>
<span class="n">ttn</span><span class="p">.</span><span class="n">sendBytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
</code></pre>
</div>

<p>To minimize your use of the limited daily airtime try to use as little bytes as possible. See the Arduino <a href="https://www.arduino.cc/en/Reference/Array">Array guide</a> and <a href="http://playground.arduino.cc/Code/BitMath#binary">Bit Math Tutorial</a> to learn more.</p>

<h2 id="receive">Receive</h2>

<p>You can only receive messages in response to a message you send, even if it is just a single byte.</p>

<ul>
<li>The <code class="highlighter-rouge">ttn.sendBytes()</code> method will return the number of bytes received, if any.</li>
  <li>Get the actual bytes via <code class="highlighter-rouge">ttn.downlink</code>.</li>
  <li>The port the response addresses can be read from <code class="highlighter-rouge">ttn.downlinkPort</code>.</li>
</ul>
<p>Your <code class="highlighter-rouge">loop()</code> function might look like:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">byte</span> <span class="n">send</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span> <span class="p">};</span>
  <span class="kt">int</span> <span class="n">downlinkBytes</span> <span class="o">=</span> <span class="n">ttn</span><span class="p">.</span><span class="n">sendBytes</span><span class="p">(</span><span class="n">send</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">send</span><span class="p">));</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">downlinkBytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">debugSerial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Received "</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">downlinkBytes</span><span class="p">)</span> <span class="o">+</span> <span class="s">" bytes via "</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">ttn</span><span class="p">.</span><span class="n">downlinkPort</span><span class="p">)</span> <span class="o">+</span> <span class="s">": "</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">downlinkBytes</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">debugSerial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">ttn</span><span class="p">.</span><span class="n">downlink</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

          </div>
        </section><section class="panel"><div class="panel-body">
            <h1 id="api-reference">API Reference</h1>

<p>Include TheThingsNetwork library:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span></code></pre>
</div>

<h2 id="method-reset">Method: reset</h2>
<p>Reset the LoRaWAN module. In most cases you’d call this with no arguments before calling <code class="highlighter-rouge">init()</code>.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="n">reset</span><span class="p">(</span><span class="n">bool</span> <span class="n">adr</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sf</span> <span class="o">=</span> <span class="n">DEFAULT_SF</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fsb</span> <span class="o">=</span> <span class="n">DEFAULT_FSB</span><span class="p">);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">bool adr = true</code> <strong>TODO</strong>
</li>
  <li>
<code class="highlighter-rouge">int sf = DEFAULT_SF</code> <strong>TODO</strong>
</li>
  <li>
<code class="highlighter-rouge">int fsb = DEFAULT_FSB</code> <strong>TODO</strong>
</li>
</ul>
<h2 id="method-init">Method: init</h2>
<p>Initialize the library with the streams it should communicate with.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="n">Stream</span><span class="o">&amp;</span> <span class="n">modemStream</span><span class="p">,</span> <span class="n">Stream</span><span class="o">&amp;</span> <span class="n">debugStream</span><span class="p">);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">Stream&amp; modemStream</code>: Stream to the LoRaWAN modem.</li>
  <li>
<code class="highlighter-rouge">Stream&amp; debugStream</code>: Stream to write debug logs to.</li>
</ul>
<p>For The Things Uno and Node use <code class="highlighter-rouge">Serial1</code> and <code class="highlighter-rouge">Serial</code>.</p>

<h2 id="method-showstatus">Method: showStatus</h2>
<p>Writes information about the device and LoRaWAN module to <code class="highlighter-rouge">debugStream</code>.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="n">showStatus</span><span class="p">();</span>
</code></pre>
</div>

<p>Will write something like:</p>

<div class="language-bash highlighter-rouge">
<pre class="highlight"><code>Device Information

EUI: 0004A30B001B672E
Battery: 3304
AppEUI: 0000000000000000
DevEUI: 0004A30B001B672E
DevAddr: 00000000
Data Rate: 5
RX Delay 1: 1000
RX Delay 2: 2000

use the device <span class="sb">`</span>EUI<span class="sb">`</span> to register the device <span class="k">for </span>OTAA
</code></pre>
</div>

<h2 id="method-join">Method: join</h2>
<p>Activate the device via OTAA.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">bool</span> <span class="n">join</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span> <span class="n">appEui</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="k">const</span> <span class="n">byte</span> <span class="n">appKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">const byte appEui[8]</code>: Application EUI the device is registered to.</li>
  <li>
<code class="highlighter-rouge">const byte appKey[16]</code>: Application Key assigned to the device.</li>
</ul>
<p>Returns <code class="highlighter-rouge">true</code> or <code class="highlighter-rouge">false</code> depending on whether it received confirmation that the activation was successful. You’ll probably call this method in a while to retry until it returns true:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">ttn</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">appEui</span><span class="p">,</span> <span class="n">appKey</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>See <a href="#activate">Library Usage / Activate</a>.</p>

<h2 id="method-personalize">Method: personalize</h2>
<p>Activate the device via ABP.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">bool</span> <span class="n">personalize</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span> <span class="n">devAddr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">const</span> <span class="n">byte</span> <span class="n">nwkSKey</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="k">const</span> <span class="n">byte</span> <span class="n">appSKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">const byte devAddr[4]</code>: Dev(ice) Address assigned to the device.</li>
  <li>
<code class="highlighter-rouge">const byte nwkSKey[16]</code>: Network Session Key assigned to the device.</li>
  <li>
<code class="highlighter-rouge">const byte appSKey[16]</code>: App(lication) Session Key assigned to the device.</li>
</ul>
<p>See <a href="#activate">Library Usage / Activate</a>.</p>

<h2 id="method-sendbytes">Method: sendBytes</h2>
<p>Send a message to the application using raw bytes.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">sendBytes</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bool</span> <span class="n">confirm</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">const byte* buffer</code>: Bytes to send.</li>
  <li>
<code class="highlighter-rouge">int length</code>: The number of bytes. Use <code class="highlighter-rouge">sizeof(buffer)</code> to get it.</li>
  <li>
<code class="highlighter-rouge">int port = 1</code>: The port to address. Defaults to <code class="highlighter-rouge">1</code>.</li>
  <li>
    <p><code class="highlighter-rouge">bool confirm = false</code>: Whether to ask for confirmation.</p>

    <ul>
<li>
<strong>TODO:</strong> How does one check the result?</li>
    </ul>
</li>
</ul>
<p>Returns the size of the message received in response, if any. Use <code class="highlighter-rouge">downlink</code> for the actual bytes received.</p>

<h2 id="method-sendstring">Method: sendString</h2>
<p>Send a message to the application using a string, which the library will encode as bytes for you.</p>

<blockquote>
  <p>To minimize air time we advise not to use this method and try to use a minimal amount of bytes to communicate your message.</p>
</blockquote>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">sendString</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bool</span> <span class="n">confirm</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</code></pre>
</div>

<ul>
<li>
<code class="highlighter-rouge">String message</code>: String to encode and send.</li>
  <li>
<code class="highlighter-rouge">int port = 1</code>: The port to address. Defaults to <code class="highlighter-rouge">1</code>.</li>
  <li>
    <p><code class="highlighter-rouge">bool confirm = false</code>: Whether to ask for confirmation.</p>

    <ul>
<li>
<strong>TODO:</strong> How does one check the result?</li>
    </ul>
</li>
</ul>
<p>Returns the size of the message received in response, if any. Use <code class="highlighter-rouge">downlink</code> for the actual bytes received.</p>

<h2 id="property-downlinkport">Property: downlinkPort</h2>
<p>The port the last message received was addressed to.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">downlinkPort</span>
</code></pre>
</div>

<h2 id="property-downlink">Property: downlink</h2>
<p>The last message received.</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">byte</span> <span class="n">downlink</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
</code></pre>
</div>

          </div>
        </section><section class="panel"><div class="panel-body">
            <h1 id="examples">Examples</h1>

<p>The library comes with a couple of examples:</p>

<ul>
<li>Select an example under <strong>File &gt; New</strong>, <strong>Open</strong> or <strong>Examples &gt; TheThingsNetwork</strong>
</li>
</ul>
</div>
        </section><section class="panel"><div class="panel-body">
            <h1 id="resources">Resources</h1>
<p>To learn more about Arduino and start prototyping with it we recommend:</p>

<h2 id="learn">Learn</h2>

<ul>
<li><a href="https://www.arduino.cc/en/Guide/HomePage">Getting Started with Arduino and Genuino products</a></li>
  <li><a href="https://www.arduino.cc/en/Tutorial/Foundations">Foundations</a></li>
</ul>
<h2 id="shields">Shields</h2>

<ul>
<li><a href="http://www.seeedstudio.com/Grove-Starter-kit-for-Arduino%26Genuino-101-p-2664.html">Grove Starter kit</a></li>
</ul>
</div>
        </section>
</div>

  </div>
</div>

<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom"></a>
  </div>
</div>

    </div>

    <script src="/docs/assets/js/bundle.js"></script><script src="https://www.thethingsnetwork.org/navbar.js"></script><script src="https://ttnstaticfile.blob.core.windows.net/static/common/js/ga.js"></script>
</body>
</html>
