<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="/docs/assets/css/main.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    (function(canonical) {
      if (document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/network/migrate.html');
    </script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Migrate from Staging to Production - The Things Network</title>
<meta property="og:title" content="Migrate from Staging to Production" />
<meta name="description" content="Migrate from Staging to Production" />
<meta property="og:description" content="Migrate from Staging to Production" />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/network/migrate.html" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/network/migrate.html" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/og-image.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-05-24T15:32:27+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Migrate from Staging to Production",
"image": "https://www.thethingsnetwork.org/docs/assets/images/og-image.png",
"datePublished": "2017-05-24T15:32:27+00:00",
"description": "Migrate from Staging to Production",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png"}},
"url": "https://www.thethingsnetwork.org/docs/network/migrate.html"}</script>
<!-- End Jekyll SEO tag -->
    <link rel="apple-touch-icon-precomposed" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Building a Global Internet of Things Network Together.">
    <meta name="msapplication-config" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/ieconfig.xml">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-32.png" sizes="32x32">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-57.png" sizes="57x57">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-76.png" sizes="76x76">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-96.png" sizes="96x96">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-120.png" sizes="120x120">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-128.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png" sizes="144x144">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png" sizes="152x152">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-180.png" sizes="180x180">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-195.png" sizes="195x195">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-228.png" sizes="228x228">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/smalltile.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/mediumtile.png" sizes="270x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/widetile.png" sizes="558x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-196.png">
    <script src="/docs/assets/js/main.js"></script>
  </head>
  <body>
    <div id="content">
<div class="layout-page">
  <div class="ttn-header ttn-header-small">
    <div class="ttn-container container-fluid">
      <h1>
        <img src="/docs/assets/images/the-things-white.png" alt="⛅ The Things Network" />
        <span>Learn</span>
      </h1>
    </div>
  </div>
  <div class="container-fluid ttn-container">
    <div class="row page-top-nav">
      <div class="col-sm-9">
        <ul>
          <li class="page-top-nav-crumb"><a href="http://www.thethingsnetwork.org/">Home</a></li>
          <li class="page-top-nav-crumb"><a href="/docs/">Learn</a></li>
                <li class=""><a href="/docs/devices/">Devices</a></li>
                <li class=""><a href="/docs/gateways/">Gateways</a></li>
                <li class="active"><a href="/docs/network/">Network</a></li>
                <li class=""><a href="/docs/applications/">Applications</a></li>
        </ul>
      </div>
      <div class="hidden-xs col-sm-3 text-right">
        <a href="https://github.com/TheThingsNetwork/docs/edit/master/_content/network/migrate.md" class="page-edit" data-proofer-ignore><i class="fa fa-github"></i> Edit <strong>migrate.md</strong></a>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">
        <div class="panel page-side-nav page-affix">
          <div class="panel-body">
            <h5>Network</h5>
            <ul>
              <li class=""><a href="/docs/network/index.html">Overview</a>
            <ul>
                <li class="active"><a href="/docs/network/migrate.html">Migrate from Staging to Production</a>
                </li>
            </ul>
              </li>
            <li class="page-side-nav-section"><span>Manage</span>
            <ul>
                <li class=""><a href="/docs/network/console/">The Things Network Console</a>
                </li>
                <li class=""><a href="/docs/network/cli/">The Things Network CLI</a>
                    <span class="label label-info">v2</span>
                </li>
            </ul>
            </li>
            <li class="page-side-nav-section"><span>Components</span>
            <ul>
                <li class=""><a href="/docs/network/account/">Account Server</a>
                </li>
                <li class=""><a href="/docs/network/discovery/">Discovery Server</a>
                </li>
            </ul>
            </li>
                <li class="page-side-nav-section"><span>Links <i class="fa fa-link"></i></span>
                  <ul>
                      <li class=""><a href="https://www.thethingsnetwork.org/wiki/Backend/">Network Architecture</a></li>
                  </ul>
                </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-sm-7">
        <div class="panel">
          <div class="panel-body page-content">
            <h1 id="migrate-from-staging-to-production">Migrate from Staging to Production</h1>
<p>This guide will walk you through migrating applications and devices from <a href="https://staging.thethingsnetwork.org/">staging.thethingsnetwork.org</a> to production at <a href="https://console.thethingsnetwork.org/">console.thethingsnetwork.org</a>.</p>
<p>For the announcement and discussion of the launch of production see the <a href="https://www.thethingsnetwork.org/forum/t/launching-production-environment/4435">forum</a>.</p>
<blockquote>
  <p>The migration does not require any changes to devices that use OTAA (the default). Devices that use ABP will need their sketch to be updated with a new Device Address.</p>
</blockquote>
<blockquote>
  <p>Messages will be routed to the new backend automatically once you have migrated a device and will no longer be delivered to staging.</p>
</blockquote>
<h2 id="applications">Applications</h2>
<p>For each application you’d like to migrate:</p>
<ol>
  <li>On <a href="https://staging.thethingsnetwork.org/applications/">staging</a>, click the application you’d like to migrate to see the <strong>Application Info</strong> box.</li>
  <li>
    <p>In <a href="https://console.thethingsnetwork.org/applications/">production</a>, go to <a href="https://console.thethingsnetwork.org/applications/add">add application</a>.</p>
    <ul>
      <li>For <strong>Application ID</strong>, use anything you like as long as it is unique and only uses low case alphanumeric charachters and nonconsecutive <code class="highlighter-rouge">-</code> and <code class="highlighter-rouge">_</code>.</li>
      <li>For <strong>Description</strong>, copy the <strong>Application name</strong> from staging.</li>
    </ul>
    <p><img src="../applications/add-application.png" alt="Add Application" /></p>
  </li>
  <li>From the <strong>Application Overview</strong> page of the newly created application, click <strong>Settings</strong> on the top right.</li>
  <li>Under <strong>App Settings</strong> select <strong>EUIs</strong>.</li>
  <li>Click <strong>remove</strong> right of the <strong>App EUI</strong> that was generated for you.</li>
  <li>
    <p>Click the <strong>add EUI</strong> or <strong>Add one!</strong> link.</p>
    <ul>
      <li>Click <i class="ion-edit"></i> to customize the EUI.</li>
      <li>Copy-paste the <strong>App EUI</strong> from the <strong>Application Info</strong> box on staging.</li>
    </ul>
    <p><img src="migrate-app-eui.png" alt="Customize EUI" /></p>
  </li>
</ol>
<h3 id="payload-functions">Payload Functions</h3>
<p>If you have customized the payload functions you’ll need to migrate those as well:</p>
<ol>
  <li>On staging, in the <strong>Application Info</strong> box click <strong>edit</strong> after <strong>Payload Functions</strong>.</li>
  <li>In production, select <strong>Payload Functions</strong> from the top right menu of the migrated application.</li>
  <li>
    <p>For each of the Payload Functions you have customized:</p>
    <ol>
      <li>Copy-paste the function body from staging to production.</li>
      <li>
        <p>Update the functions, following these signatures:</p>
        <ul>
          <li>Functions are no longer anonymous.</li>
          <li>You can leave the name of the first argument as you had it in staging.</li>
          <li>Functions have an optional second argument for the port.</li>
        </ul>
        <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="cm">/* fields */</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Converter</span><span class="p">(</span><span class="nx">decoded</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">decoded</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Validator</span><span class="p">(</span><span class="nx">converted</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Encoder</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span> <span class="sr">/ * bytes */</span> <span class="p">];</span>
<span class="p">}</span>
</code></pre>
        </div>
      </li>
    </ol>
  </li>
</ol>
<h2 id="devices">Devices</h2>
<p>For each device you’d like to migrate:</p>
<ol>
  <li>On <a href="https://staging.thethingsnetwork.org/applications/">staging</a>, go to the application you’d like to migrate devices from.</li>
  <li>In the <strong>Devices</strong> box click the <strong>Dev EUI</strong> of the device you’d like to migrate to see its <strong>Device info</strong> box.</li>
  <li>In <a href="https://console.thethingsnetwork.org/applications/">production</a>, go to the migrated application.</li>
  <li>Scroll down to <strong>Devices</strong> or select <strong>Devices</strong> from the top right menu.</li>
  <li>Click <strong>register device</strong>.
    <ul>
      <li>For <strong>Device ID</strong>, use anything you like as long as it is unique and only uses alphanumeric charachters and nonconsecutive <code class="highlighter-rouge">-</code> and <code class="highlighter-rouge">_</code>.</li>
      <li>For <strong>Device EUI</strong>, click <strong>customize it</strong> and copy-paste the <strong>Dev EUI</strong> from staging.</li>
      <li>For <strong>App Key</strong>, click <strong>customize it</strong> and copy-paste the <strong>App Key</strong> from staging.</li>
      <li>For <strong>App EUI</strong>, click to select the <strong>App EUI</strong> from staging which you added when you migrated the application.</li>
    </ul>
    <p><img src="../devices/register-device.png" alt="Register Device" /></p>
  </li>
  <li>
    <p>Click <em>Register</em> to finish.</p>
    <blockquote>
      <p>Made a mistake? You can always come back to a device and select <strong>Settings</strong> from the top right menu to change all of the above settings, except the <strong>Device ID</strong>.</p>
    </blockquote>
  </li>
  <li>
    <p>On staging, delete the device or you will risk join accept and routing conflicts.</p>
    <ol>
      <li>On staging, go to the migrated device.</li>
      <li>Scroll down to the bottom and click the red <strong>Delete device</strong> button.</li>
    </ol>
  </li>
</ol>
<blockquote>
  <p>Important: If your application on staging used to activate devices with a <strong>Default App Key</strong>, activations in staging should be disabled for your <strong>App EUI</strong>. This requires your <strong>App EUI</strong> to be blacklisted in staging. To request a blacklist, please file a request through The Things Network’s Slack <strong>#support</strong> channel. <a href="https://account.thethingsnetwork.org">Request a Slack invite for your account</a></p>
</blockquote>
<h3 id="devices-registered-for-abp">Devices registered for ABP</h3>
<p>If you had your device registered for ABP, follow these additional steps:</p>
<ol>
  <li>Navigate to the migrated device if you’re not there already.</li>
  <li>
    <p>Select <strong>Settings</strong> from the top right menu.</p>
    <ul>
      <li>For <strong>Activation method</strong> select <strong>ABP</strong>.</li>
      <li>For <strong>Network Session Key</strong>, click <i class="ion-edit"></i> and copy-paste the <strong>Network Session Key</strong> from staging.</li>
      <li>For <strong>App Session Key</strong>, click <i class="ion-edit"></i> and copy-paste the <strong>App Session Key</strong> from staging.</li>
    </ul>
  </li>
  <li>Click <strong>Save</strong>, which will redirect you back to the device screen.</li>
  <li>Connect the device.</li>
  <li>
    <p>Update the following line of your sketch with the generated <strong>Device Address</strong>:</p>
    <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">devAddr</span> <span class="o">=</span> <span class="s">"00000000"</span><span class="p">;</span>
</code></pre>
    </div>
  </li>
</ol>
<h2 id="mqtt">MQTT</h2>
<p>If you have been using the MQTT broker at <code class="highlighter-rouge">staging.thethingsnetwork.org</code>, then this section will help you migrate to one of the new production brokers at <code class="highlighter-rouge">&lt;Region&gt;.thethings.network</code>.</p>
<h3 id="region-specific-hostname">Region-specific hostname</h3>
<p>In staging you connected to <code class="highlighter-rouge">staging.thethingsnetwork.org</code>. Replace this with <code class="highlighter-rouge">&lt;Region&gt;.thethings.network</code>. See <a href="../applications/mqtt/quick-start.html#credentials">MQTT / Quick Start / Credentials</a> to learn what region to use.</p>
<h3 id="application-eui-becomes-id">Application EUI becomes ID</h3>
<p>In staging you used the <strong>Application EUI</strong> as username and as first element in all topics. Replace this with the <strong>Application ID</strong>.</p>
<p><strong>Staging:</strong></p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h staging.thethingsnetwork.org -t <span class="s1">'#'</span> -u &lt;AppEUI -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
</div>
<p><strong>Production:</strong></p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h &lt;Region&gt;.thethings.network -t <span class="s1">'#'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
</div>
<h3 id="activations">Activations</h3>
<p>The topic has changed to <code class="highlighter-rouge">&lt;AppId&gt;/devices/&lt;DevId&gt;/events/activations</code>.</p>
<p>The JSON encoded payload has also changed on several points. Update the code where you process it.</p>
<p><strong>Staging:</strong></p>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datarate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"codingrate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateway_timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">3475324075</span><span class="p">,</span><span class="w">
    </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"server_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-12T14:00:16.614852216Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-42</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lsnr"</span><span class="p">:</span><span class="w"> </span><span class="mf">9.2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rfchain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"crc"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"altitude"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.90418</span><span class="p">,</span><span class="w">
    </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.95904</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p><strong>Production:</strong></p>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"app_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"70B3D57EF000001C"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0004A30B001B7AD2"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_addr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"26012723"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:02.90329585Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"coding_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateways"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eui-b827ebfffe87bd22"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1484146403</span><span class="p">,</span><span class="w">
      </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:02.867283Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-49</span><span class="p">,</span><span class="w">
      </span><span class="nt">"snr"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rf_chain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<blockquote>
  <p>Note that you now receive the Application EUI and the Device EUI and Address. Also, Gateway metadata can now be found in an array of all gateways that forwarded the activation.</p>
</blockquote>
<h3 id="uplink-payload">Uplink payload</h3>
<p>The JSON encoded payload has changed on several points. Update the code where you process it.</p>
<p><strong>Staging:</strong></p>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0004A30B001B7AD2"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">867.3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datarate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"codingrate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateway_timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">3662434019</span><span class="p">,</span><span class="w">
    </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="nt">"server_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-12T14:03:23.729350993Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-43</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lsnr"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.8</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rfchain"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"crc"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"altitude"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.90418</span><span class="p">,</span><span class="w">
    </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.95904</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p><strong>Production:</strong></p>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"payload_raw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"payload_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:08.179119279Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"coding_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateways"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eui-b827ebfffe87bd22"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1489443003</span><span class="p">,</span><span class="w">
      </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:08.167028Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-49</span><span class="p">,</span><span class="w">
      </span><span class="nt">"snr"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rf_chain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<blockquote>
  <p>Note that <code class="highlighter-rouge">payload</code> is now <code class="highlighter-rouge">payload_raw</code> and <code class="highlighter-rouge">fields</code> has been renamed to <code class="highlighter-rouge">payload_fields</code>. Also, <code class="highlighter-rouge">dev_eui</code> is no longer there and Gateway metadata can now be found in an array of all gateways that forwarded the activation.</p>
</blockquote>
<h3 id="downlink-payload">Downlink payload</h3>
<p>The JSON encoded payload to send a message has also changed. Update the code where you compose the payload.</p>
<p><strong>Staging:</strong></p>
<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"ttl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1h"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p><strong>Production:</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload_raw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<blockquote>
  <p>Note that <code class="highlighter-rouge">payload</code> has been renamed to <code class="highlighter-rouge">payload_raw</code> and <code class="highlighter-rouge">ttl</code> is no longer included. Also consider to use the new <a href="../applications/mqtt/api.html#downlink-fields"><code class="highlighter-rouge">payload_fields</code></a>.</p>
</blockquote>
<h2 id="sdks--libraries">SDKs &amp; Libraries</h2>
<p>We are using a versioning format where the same major version means compatibility. All 2.x components will be compatible with each other, including the routing services, Console, Account Server, SDKs, platform integrations and libraries.</p>
<h3 id="arduino-library">Arduino Library</h3>
<p>Although version 1.x of the Arduino Library worked fine with both staging and production, we’ve released 2.x to follow the above convention. Get it via the Arduino IDE. This version (for now) continuous to work with staging as well.</p>
<h3 id="nodejs-sdk">Node.js SDK</h3>
<p>For production use versions 2.x:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save ttn
</code></pre>
</div>
<p>Carefully study and compare the API References of <a href="../applications/nodejs-v1/api.html">1.x</a> and <a href="../applications/nodejs/api.html">2.x</a> to migrate any application code that you use the SDK in.</p>
<p>The last version compatible with staging is 1.3.2:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save ttn@1.3.2
</code></pre>
</div>
<h3 id="node-red-node">Node-RED Node</h3>
<p>For production use versions 2.x:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install node-red-contrib-ttn
</code></pre>
</div>
<p>After updating you will need to update an perhaps even re-add some of the <code class="highlighter-rouge">ttn-*</code> nodes because there are a lot of breaking changes. Carefully study and compare the guides of <a href="../applications/nodered-v1/">1.x</a> and <a href="../applications/nodered/">2.x</a>.</p>
<p>The last version compatible with staging is 1.0.0:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install node-red-contrib-ttn@1.0.0
</code></pre>
</div>
<h3 id="java-sdk">Java SDK</h3>
<p>For production use versions 2.x. Although 1.x already supported production and not staging, we bumped to 2.x to align it with other SDKs and components. As part of this we did change the package and class names in preparation for adding more APIs to this SDK.</p>
<p>Please check the <a href="../applications/java/">Java guide</a> for more details.</p>
<h2 id="cli">CLI</h2>
<p>Versions 2.x of The Things Network CLI are compatible with production. See the <a href="../network/cli/quick-start.html#installation">Quick Start</a> for installation instructions.</p>
<p>For staging, you can continue to use the <a href="../network/cli-v1/quick-start.html#installation"><code class="highlighter-rouge">v1-staging</code></a> version. However, since <code class="highlighter-rouge">account.thethingsnetwork.org</code> is now production and staging has been renamed to <code class="highlighter-rouge">v1.account.thethingsnetwork.org</code> you will need to <a href="../network/cli-v1/configuration.html">reconfigure</a> it to use this new hostname.</p>
          </div>
        </div>
      </div>
      <div class="hidden-xs col-sm-2">
        <div class="page-toc page-affix"></div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>
<script src="/docs/assets/js/page.js"></script>
    </div>
    <script src="https://www.thethingsnetwork.org/navbar.js"></script>
    <script src="https://ttnstaticfile.blob.core.windows.net/static/common/js/ga.js"></script>
  </body>
</html>
