<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- 20111122 0939 -->

    <link rel="stylesheet" href="/docs/assets/css/main.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>

    var site = {
      baseurl: '/docs',
      local: (document.location.port || document.location.protocol === 'file:')
    };

    (function(canonical) {
      if (!site.local && document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/v2-preview/mqtt/');

    </script>

    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>MQTT - The Things Network</title>
<meta property="og:title" content="MQTT" />
<meta name="description" content="MQTT is a machine-to-machine (M2M)/”Internet of Things” connectivity protocol. It was designed as an extremely lightweight publish/subscribe messaging transport." />
<meta property="og:description" content="MQTT is a machine-to-machine (M2M)/”Internet of Things” connectivity protocol. It was designed as an extremely lightweight publish/subscribe messaging transport." />
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/v2-preview/mqtt/" />
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/v2-preview/mqtt/" />
<meta property="og:site_name" content="The Things Network" />
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-12-08T09:46:30+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thethingsnetwrk" />
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "MQTT",
"image": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png",
"datePublished": "2016-12-08T09:46:30+00:00",
"description": "MQTT is a machine-to-machine (M2M)/”Internet of Things” connectivity protocol. It was designed as an extremely lightweight publish/subscribe messaging transport.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png"}},
"url": "https://www.thethingsnetwork.org/docs/v2-preview/mqtt/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="apple-touch-icon-precomposed" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png">
    <meta name="application-name" content="The Things Network">
    <meta name="msapplication-tooltip" content="Building a Global Internet of Things Network Together.">
    <meta name="msapplication-config" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/ieconfig.xml">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-32.png" sizes="32x32">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-57.png" sizes="57x57">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-76.png" sizes="76x76">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-96.png" sizes="96x96">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-120.png" sizes="120x120">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-128.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png" sizes="144x144">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png" sizes="152x152">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-180.png" sizes="180x180">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-195.png" sizes="195x195">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-228.png" sizes="228x228">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/smalltile.png" sizes="128x128">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/mediumtile.png" sizes="270x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/widetile.png" sizes="558x270">
    <link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png" sizes="558x558">
    <link rel="shortcut icon" sizes="196x196" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-196.png">
      
  </head>
  <body>

    <div id="content">
      










<div id="top" class="layout-guide container">

  <div class="row guide-nav">
    <div class="col-sm-9">
      <ol class="breadcrumb">
        <li><a href="http://www.thethingsnetwork.org/">Home</a></li>
        <li><a href="/docs/">Learn</a></li>
        
        <li class="active">MQTT</li>
      </ol>
    </div>
    <div class="col-sm-3 text-right">
      <a class="btn btn-default hidden-xs" href="http://github.com/TheThingsNetwork/docs/edit/master/_includes/v2-preview/mqtt.md" target="_blank"><i class="fa fa-pencil"></i> Improve this guide</a>
    </div>
  </div>

  <div class="row">

    <div class="col-md-3" role="complementary">

      <div class="guide-switch btn-group btn-block">
        <button type="button" class="btn btn-primary btn-block dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Guides <span class="caret"></span></button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          
            
            
              
                <li class="disabled"><a href="#">
              
              The Things Node
              
              </a></li>
            
              
                <li><a href="/docs/current/uno/">
              
              The Things Uno
              
              </a></li>
            
              
                <li><a href="/docs/current/arduino/">
              
              Arduino
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Devices
              
              </a></li>
            
          
            <li role="separator" class="divider"></li>
            
              
                <li class="disabled"><a href="#">
              
              The Things Gateway
              
              </a></li>
            
              
                <li><a href="/docs/current/multitech/">
              
              MultiTech Conduit
              
              </a></li>
            
              
                <li><a href="/docs/current/lorrier/">
              
              Lorrier LR2
              
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Gateways
              
              </a></li>
            
          
            <li role="separator" class="divider"></li>
            
              
                <li><a href="/docs/current/dashboard/">
              
              The Things Dashboard
              
              </a></li>
            
              
                <li><a href="/docs/current/cli/">
              
              The Things CLI
              
              </a></li>
            
              
                <li><a href="https://www.thethingsnetwork.org/wiki/Backend/Overview">
              
              Architecture
              
              </a></li>
            
          
            <li role="separator" class="divider"></li>
            
              
                <li><a href="/docs/current/mqtt/">
              
              MQTT
              <span class="label label-info">API</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-js/">
              
              Node.js
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-red/">
              
              Node-RED
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/v2-preview/java/">
              
              Java
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Platforms
              
              </a></li>
            
          
        </ul>
      </div>

      <div class="guide-sidebar hidden-xs hidden-sm">

        <div class="js-toc"></div>

        <p class="guide-top"><a href="#top">Back to top</a></p>

      </div>

    </div>

    <div class="col-md-9 js-toc-content content-body" role="main">

      
        <div class="alert alert-warning"><strong>Attention:</strong> You are reading the <small>V2-PREVIEW</small> and not the <small><a href="/docs/current/mqtt/">CURRENT</a></small> version of this guide.  The UI and APIs might change and registered applications and devices might be deleted at any moment!</div>
      

      
      

      <section class="panel">
        <div class="panel-body">
          <span class="label label-success pull-right">V2-PREVIEW</span>
          <h1>MQTT</h1>
          <p><a href="http://mqtt.org">MQTT</a> is a machine-to-machine (M2M)/”Internet of Things” connectivity protocol. It was designed as an extremely lightweight publish/subscribe messaging transport.</p>

<p>The Things Network uses MQTT to publish device activations and messages, but also allows you to publish a message for a specific device in response.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Access to <a href="https://preview.console.thethingsnetwork.org/">preview.console.thethingsnetwork.org</a>.</li>
  <li>Access to an application with registered device on TTN.</li>
</ul>

        </div>
        
          <div class="panel-footer">
            Versions:&nbsp;&nbsp;&nbsp; 
            
              <a href="/docs/current/mqtt/" class="label label-default">CURRENT</a>
            
            
              
              
            
              
              
                <a href="/docs/v2-preview/mqtt/" class="label label-success">V2-PREVIEW</a>
              
            
          </div>
        
      </section>

      

      
        
        
        <section class="panel">
          <div class="panel-body">
            <h1 id="clients">Clients</h1>

<p>You can find MQTT Client libaries for any language or platform:</p>

<ul>
  <li>For an extensive list see the official <a href="https://github.com/mqtt/mqtt.github.io/wiki/libraries">MQTT.org Wiki</a>.</li>
  <li>The <a href="http://www.eclipse.org/paho/">Eclipse Paho</a> project provides open-source client implementations for a good number of languages.</li>
  <li><a href="https://mosquitto.org">Eclipse Mosquitto</a> providers a CLI to <a href="https://mosquitto.org/man/mosquitto_sub-1.html">subscribe</a> and to <a href="https://mosquitto.org/man/mosquitto_pub-1.html">publish</a> messages.</li>
</ul>

<p>We’ll use Mosquitto as example in the <a href="#api-reference">API Reference</a>.</p>

<h2 id="the-things-network">The Things Network</h2>

<p>To hide the complexity of parsing and composing the message payloads from you, The Things Network will develop client libraries for popular languages and platforms.</p>

<p>At the moment, we offer clients for:</p>

<ul>
  <li><a href="/docs/v2-preview/node-js">Node.js</a></li>
  <li><a href="/docs/v2-preview/node-red">Node-RED</a></li>
</ul>

<p>If you’d like to create and maintain a client for another language or platform, let us know! We’d like to support you and look after achieving consistent APIs across libraries.</p>

          </div>
        </section>
      
        
        
        <section class="panel">
          <div class="panel-body">
            <h1 id="quick-start">Quick Start</h1>
<p>This guide will walk you through subscribing to an application’s activations and messages as well as send a response to a specific device, using <a href="https://mosquitto.org">Eclipse Mosquitto</a>’s CLIs to <a href="https://mosquitto.org/man/mosquitto_sub-1.html">subscribe</a> and to <a href="https://mosquitto.org/man/mosquitto_pub-1.html">publish</a> messages.</p>

<blockquote>
  <p>This guide assumes the sketch and payload functions of <a href="/docs/v2-preview/uno/#quick-start">The Things Uno / Quick Start</a>, but can be easily applied to any other.</p>
</blockquote>

<h2 id="setup">Setup</h2>

<ul>
  <li><a href="https://mosquitto.org/download/">Download</a> Mosquitto.</li>
  <li>Download and save the <a href="https://preview.console.thethingsnetwork.org/mqtt-ca.pem">PEM encoded CA certificate</a> if you’d like to use TLS.</li>
</ul>

<h2 id="credentials">Credentials</h2>

<p>On <a href="https://preview.console.thethingsnetwork.org/">preview.console.thethingsnetwork.org</a>, navigate to the application you’d like to use. Here you can find the <strong>Application ID</strong> and an <strong>Access Key</strong> needed to authenticate over MQTT. Under <strong>Handler Status</strong> you will also find the region the application is registered to. You will need the part that follows <code class="highlighter-rouge">ttn-handler-</code>, e.g. <code class="highlighter-rouge">eu</code>.</p>

<h2 id="receive-activations">Receive Activations</h2>
<p>Let’s listen for new device activations first.</p>

<ol>
  <li>
    <p>Open a terminal window and execute the following command:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h &lt;Region&gt;.thethings.network -t <span class="s1">'+/devices/+/events/activations'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
    </div>

    <ul>
      <li>Replace <code class="highlighter-rouge">&lt;Region&gt;</code> with the region you looked up.</li>
      <li>Replace <code class="highlighter-rouge">&lt;AppID&gt;</code> with your <strong>Application ID</strong>.</li>
      <li>Replace <code class="highlighter-rouge">&lt;AppKey&gt;</code> with your <strong>Access Key</strong> (base64).</li>
    </ul>

    <blockquote>
      <p>We add <code class="highlighter-rouge">-v</code> to also see the topics of the incoming messages.</p>
    </blockquote>

    <p>For TLS - assuming <a href="https://preview.console.thethingsnetwork.org/mqtt-ca.pem">mqtt-ca.pem</a> is in the same folder - append:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>--cafile mqtt-ca.pem -p 8883
</code></pre>
    </div>
  </li>
  <li>
    <p>Power up, reset or upload a new sketch to a device to force it to activate and you should see something like:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>hello-world/devices/my-uno/events/activations <span class="o">{</span><span class="s2">"app_eui"</span>:<span class="s2">"70B3D57EF000001C"</span>,<span class="s2">"dev_eui"</span>:<span class="s2">"0004A30B001B7AD2"</span>,<span class="s2">"dev_addr"</span>:<span class="s2">"26012723"</span>,<span class="s2">"metadata"</span>:<span class="o">{</span><span class="s2">"time"</span>:<span class="s2">"2016-09-13T09:59:02.90329585Z"</span>,<span class="s2">"frequency"</span>:868.5,<span class="s2">"modulation"</span>:<span class="s2">"LORA"</span>,<span class="s2">"data_rate"</span>:<span class="s2">"SF7BW125"</span>,<span class="s2">"coding_rate"</span>:<span class="s2">"4/5"</span>,<span class="s2">"gateways"</span>:[<span class="o">{</span><span class="s2">"eui"</span>:<span class="s2">"B827EBFFFE87BD22"</span>,<span class="s2">"timestamp"</span>:1484146403,<span class="s2">"time"</span>:<span class="s2">"2016-09-13T09:59:02.867283Z"</span>,<span class="s2">"channel"</span>:2,<span class="s2">"rssi"</span>:-49,<span class="s2">"snr"</span>:7,<span class="s2">"rf_chain"</span>:1<span class="o">}]}}</span>
</code></pre>
    </div>

    <p>Use <code class="highlighter-rouge">Ctrl C</code> to exit.</p>
  </li>
</ol>

<h2 id="receive-messages-up">Receive Messages (up)</h2>
<p>Now let’s listen for actual messages coming in from devices.</p>

<ol>
  <li>
    <p>Open another terminal window and execute the following command:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h &lt;Region&gt;.thethings.network -t <span class="s1">'+/devices/+/up'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
    </div>

    <blockquote>
      <p>Don’t forget to replace <code class="highlighter-rouge">&lt;Region&gt;</code>, <code class="highlighter-rouge">&lt;AppID&gt;</code>, <code class="highlighter-rouge">&lt;AppKey&gt;</code> and append the options for TLS if you used that.</p>
    </blockquote>
  </li>
  <li>
    <p>If you uploaded the <a href="/docs/v2-preview/uno/#quick-start">The Things Uno / Quick Start</a> sketch you should see something like:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>hello-world/devices/my-uno/up <span class="o">{</span><span class="s2">"port"</span>:1,<span class="s2">"counter"</span>:5,<span class="s2">"payload_raw"</span>:<span class="s2">"AQ=="</span>,<span class="s2">"payload_fields"</span>:<span class="o">{</span><span class="s2">"led"</span>:true<span class="o">}</span>,<span class="s2">"metadata"</span>:<span class="o">{</span><span class="s2">"time"</span>:<span class="s2">"2016-09-14T14:19:20.272552952Z"</span>,<span class="s2">"frequency"</span>:868.1,<span class="s2">"modulation"</span>:<span class="s2">"LORA"</span>,<span class="s2">"data_rate"</span>:<span class="s2">"SF7BW125"</span>,<span class="s2">"coding_rate"</span>:<span class="s2">"4/5"</span>,<span class="s2">"gateways"</span>:[<span class="o">{</span><span class="s2">"eui"</span>:<span class="s2">"B827EBFFFE87BD22"</span>,<span class="s2">"timestamp"</span>:1960494347,<span class="s2">"time"</span>:<span class="s2">"2016-09-14T14:19:20.258723Z"</span>,<span class="s2">"rssi"</span>:-49,<span class="s2">"snr"</span>:9.5,<span class="s2">"rf_chain"</span>:1<span class="o">}]}}</span>
</code></pre>
    </div>
  </li>
</ol>

<h3 id="subscribe-to-a-specific-field">Subscribe to a specific field</h3>

<p>You can also subscribe to a specific field. Building on <a href="/docs/v2-preview/uno/#quick-start">The Things Uno / Quick Start</a> you could subscribe to get just the <code class="highlighter-rouge">led</code> field:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h &lt;Region&gt;.thethings.network -t <span class="s1">'+/devices/+/up/led'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -v

hello-world/devices/my-uno/up/led <span class="nb">true</span>
</code></pre>
</div>

<h2 id="send-messages-down">Send Messages (down)</h2>
<p>To send a message you will have to address a specific device by its <strong>Device ID</strong>. Let’s send the same message used in the <a href="/docs/v2-preview/uno/#message-your-device">The Things Uno / Quick Start</a>:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>
  <span class="s2">"led"</span>: <span class="nb">true</span>
<span class="o">}</span>
</code></pre>
</div>

<p>If you have followed <a href="../uno/#encode-messages">The Things Uno / Quick Start / Encode Messages</a> you can send this as is using the <code class="highlighter-rouge">payload_fields</code> key:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Otherwise, you’ll have to use <code class="highlighter-rouge">payload_raw</code> and send a base64 encoded array of bytes, e.g.:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload_raw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<ol>
  <li>
    <p>Open another terminal window and execute the following command:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_pub -h &lt;Region&gt;.thethings.network -t <span class="s1">'&lt;AppID&gt;/devices/&lt;DevID&gt;/down'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -m <span class="s1">'{"payload_fields":{"led":true}}'</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>If you are running <a href="/docs/v2-preview/uno/#quick-start">The Things Uno / Quick Start</a> sketch you should see something like:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>-- LOOP
Sending: mac tx uncnf 1 with 1 bytes
Successful transmission. Received 1 bytes
LED: on
</code></pre>
    </div>
  </li>
</ol>

<p>🎉 Congratulations! Now you know how to monitor and send messages via MQTT. Go build something awesome!</p>

          </div>
        </section>
      
        
        
        <section class="panel">
          <div class="panel-body">
            <!-- EDIT AT https://github.com/TheThingsNetwork/ttn/blob/v2-preview/mqtt/README.md -->

<h1 id="api-reference">API Reference</h1>

<ul>
  <li>Host: <code class="highlighter-rouge">&lt;Region&gt;.thethings.network</code>, where <code class="highlighter-rouge">&lt;Region&gt;</code> is last part of the handler you registered your application to, e.g. <code class="highlighter-rouge">eu</code>.</li>
  <li>Port: <code class="highlighter-rouge">1883</code> or <code class="highlighter-rouge">8883</code> for TLS</li>
  <li>PEM encoded CA certificate for TLS: <a href="https://preview.console.thethingsnetwork.org/mqtt-ca.pem">mqtt-ca.pem</a></li>
  <li>Username: Application ID</li>
  <li>Password: Application Access Key</li>
</ul>

<h2 id="uplink-messages">Uplink Messages</h2>

<p><strong>Topic:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/up</code></p>

<p><strong>Message:</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"port"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>                          <span class="c1">// LoRaWAN FPort</span>
  <span class="s2">"counter"</span><span class="err">:</span> <span class="mi">2</span><span class="p">,</span>                       <span class="c1">// LoRaWAN frame counter</span>
  <span class="s2">"payload_raw"</span><span class="err">:</span> <span class="s2">"AQIDBA=="</span><span class="p">,</span>          <span class="c1">// Base64 encoded payload: [0x01, 0x02, 0x03, 0x04]</span>
  <span class="s2">"payload_fields"</span><span class="err">:</span> <span class="p">{},</span>               <span class="c1">// Object containing the results from the payload functions - left out when empty</span>
  <span class="s2">"metadata"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"time"</span><span class="err">:</span> <span class="s2">"1970-01-01T00:00:00Z"</span><span class="p">,</span>   <span class="c1">// Time when the server received the message</span>
    <span class="s2">"frequency"</span><span class="err">:</span> <span class="mf">868.1</span><span class="p">,</span>               <span class="c1">// Frequency at which the message was sent</span>
    <span class="s2">"modulation"</span><span class="err">:</span> <span class="s2">"LORA"</span><span class="p">,</span>             <span class="c1">// Modulation that was used - currently only LORA. In the future we will support FSK as well</span>
    <span class="s2">"data_rate"</span><span class="err">:</span> <span class="s2">"SF7BW125"</span><span class="p">,</span>          <span class="c1">// Data rate that was used - if LORA modulation</span>
    <span class="s2">"bit_rate"</span><span class="err">:</span> <span class="mi">50000</span><span class="p">,</span>                <span class="c1">// Bit rate that was used - if FSK modulation</span>
    <span class="s2">"coding_rate"</span><span class="err">:</span> <span class="s2">"4/5"</span><span class="p">,</span>             <span class="c1">// Coding rate that was used</span>
    <span class="s2">"gateways"</span><span class="err">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"ttn-herengracht-ams"</span><span class="p">,</span>    <span class="c1">// EUI of the gateway</span>
        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="mi">12345</span><span class="p">,</span>             <span class="c1">// Timestamp when the gateway received the message</span>
        <span class="s2">"time"</span><span class="p">:</span> <span class="s2">"1970-01-01T00:00:00Z"</span><span class="p">,</span> <span class="c1">// Time when the gateway received the message - left out when gateway does not have synchronized time </span>
        <span class="s2">"channel"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                   <span class="c1">// Channel where the gateway received the message</span>
        <span class="s2">"rssi"</span><span class="p">:</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span>                    <span class="c1">// Signal strength of the received message</span>
        <span class="s2">"snr"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>                       <span class="c1">// Signal to noise ratio of the received message</span>
        <span class="s2">"rf_chain"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                  <span class="c1">// RF chain where the gateway received the message</span>
      <span class="p">},</span>
      <span class="c1">//...more if received by more gateways...</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Note: Some values may be omitted if they are <code class="highlighter-rouge">null</code>, <code class="highlighter-rouge">""</code> or <code class="highlighter-rouge">0</code>.</p>

<p><strong>Usage (Mosquitto):</strong> <code class="highlighter-rouge">mosquitto_sub -h &lt;Region&gt;.thethings.network:1883 -d -t 'my-app-id/devices/my-dev-id/up'</code></p>

<p><strong>Usage (Go client):</strong></p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">log</span><span class="o">.</span><span class="n">WithField</span><span class="p">(</span><span class="s">"Example"</span><span class="p">,</span><span class="x"> </span><span class="s">"Go Client"</span><span class="p">)</span><span class="x">
</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">NewClient</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="s">"ttnctl"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-access-key"</span><span class="p">,</span><span class="x"> </span><span class="s">"&lt;Region&gt;.thethings.network:1883"</span><span class="p">)</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Connect</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not connect"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">token</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">SubscribeDeviceUplink</span><span class="p">(</span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-dev-id"</span><span class="p">,</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">client</span><span class="x"> </span><span class="n">Client</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">devID</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="x"> </span><span class="n">types</span><span class="o">.</span><span class="n">UplinkMessage</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="c">// Do something with the uplink message</span><span class="x">
</span><span class="p">})</span><span class="x">
</span><span class="n">token</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">token</span><span class="o">.</span><span class="n">Error</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not subscribe"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<h3 id="uplink-fields">Uplink Fields</h3>

<p>Each uplink field will be published to its own topic <code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/&lt;field&gt;</code>. The payload will be a string with the value in a JSON-style encoding.</p>

<p>If your fields look like the following:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"water"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"analog"</span><span class="err">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
  <span class="s2">"gps"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"lat"</span><span class="err">:</span> <span class="mf">52.3736735</span><span class="p">,</span>
    <span class="s2">"lon"</span><span class="err">:</span> <span class="mf">4.886663</span>
  <span class="p">},</span>
  <span class="s2">"text"</span><span class="err">:</span> <span class="s2">"why are you using text?"</span>
<span class="p">}</span>
</code></pre>
</div>

<p>you will see this on MQTT:</p>

<ul>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/water</code>: <code class="highlighter-rouge">true</code></li>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/analog</code>: <code class="highlighter-rouge">[0, 255, 500, 1000]</code></li>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/gps</code>: <code class="highlighter-rouge"><span class="p">{</span><span class="nt">"lat"</span><span class="p">:</span><span class="mf">52.3736735</span><span class="p">,</span><span class="nt">"lon"</span><span class="p">:</span><span class="mf">4.886663</span><span class="p">}</span></code></li>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/gps/lat</code>: <code class="highlighter-rouge">52.3736735</code></li>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/gps/lon</code>: <code class="highlighter-rouge">4.886663</code></li>
  <li><code class="highlighter-rouge">my-app-id/devices/my-dev-id/up/text</code>: <code class="highlighter-rouge">"why are you using text?"</code></li>
</ul>

<h2 id="downlink-messages">Downlink Messages</h2>

<p><strong>Topic:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/down</code></p>

<p><strong>Message:</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"port"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>                 <span class="c1">// LoRaWAN FPort</span>
  <span class="s2">"payload_raw"</span><span class="err">:</span> <span class="s2">"AQIDBA=="</span><span class="p">,</span> <span class="c1">// Base64 encoded payload: [0x01, 0x02, 0x03, 0x04]</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Usage (Mosquitto):</strong> <code class="highlighter-rouge">mosquitto_pub -h &lt;Region&gt;.thethings.network:1883 -d -t 'my-app-id/devices/my-dev-id/down' -m '{"port":1,"payload_raw":"AQIDBA=="}'</code></p>

<p><strong>Usage (Go client):</strong></p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">log</span><span class="o">.</span><span class="n">WithField</span><span class="p">(</span><span class="s">"Example"</span><span class="p">,</span><span class="x"> </span><span class="s">"Go Client"</span><span class="p">)</span><span class="x">
</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">NewClient</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="s">"ttnctl"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-access-key"</span><span class="p">,</span><span class="x"> </span><span class="s">"&lt;Region&gt;.thethings.network:1883"</span><span class="p">)</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Connect</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not connect"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">token</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">PublishDownlink</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">DownlinkMessage</span><span class="p">{</span><span class="x">
  </span><span class="n">AppID</span><span class="o">:</span><span class="x">   </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x">
  </span><span class="n">DevID</span><span class="o">:</span><span class="x">   </span><span class="s">"my-dev-id"</span><span class="p">,</span><span class="x">
  </span><span class="n">FPort</span><span class="o">:</span><span class="x">   </span><span class="m">1</span><span class="p">,</span><span class="x">
  </span><span class="n">Payload</span><span class="o">:</span><span class="x"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">{</span><span class="m">0x01</span><span class="p">,</span><span class="x"> </span><span class="m">0x02</span><span class="p">,</span><span class="x"> </span><span class="m">0x03</span><span class="p">,</span><span class="x"> </span><span class="m">0x04</span><span class="p">},</span><span class="x">
</span><span class="p">})</span><span class="x">
</span><span class="n">token</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">token</span><span class="o">.</span><span class="n">Error</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not publish"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<h3 id="downlink-fields">Downlink Fields</h3>

<p>Instead of <code class="highlighter-rouge">payload_raw</code> you can also use <code class="highlighter-rouge">payload_fields</code> with an object of fields. This requires the application to be configured with an Encoder Payload Function which encodes the fields into a Buffer.</p>

<p><strong>Message:</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"port"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>                 <span class="c1">// LoRaWAN FPort</span>
  <span class="s2">"payload_fields"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"led"</span><span class="err">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Usage (Mosquitto):</strong> <code class="highlighter-rouge">mosquitto_pub -h &lt;Region&gt;.thethings.network:1883 -d -t 'my-app-id/devices/my-dev-id/down' -m '{"port":1,"payload_fields":{"led":true}}'</code></p>

<p><strong>Usage (Go client):</strong></p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">log</span><span class="o">.</span><span class="n">WithField</span><span class="p">(</span><span class="s">"Example"</span><span class="p">,</span><span class="x"> </span><span class="s">"Go Client"</span><span class="p">)</span><span class="x">
</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">NewClient</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="s">"ttnctl"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-access-key"</span><span class="p">,</span><span class="x"> </span><span class="s">"&lt;Region&gt;.thethings.network:1883"</span><span class="p">)</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Connect</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not connect"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">token</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">PublishDownlink</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">DownlinkMessage</span><span class="p">{</span><span class="x">
  </span><span class="n">AppID</span><span class="o">:</span><span class="x">   </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x">
  </span><span class="n">DevID</span><span class="o">:</span><span class="x">   </span><span class="s">"my-dev-id"</span><span class="p">,</span><span class="x">
  </span><span class="n">FPort</span><span class="o">:</span><span class="x">   </span><span class="m">1</span><span class="p">,</span><span class="x">
  </span><span class="n">Fields</span><span class="o">:</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span><span class="x">
    </span><span class="s">"led"</span><span class="o">:</span><span class="x"> </span><span class="no">true</span><span class="p">,</span><span class="x">
  </span><span class="p">},</span><span class="x">
</span><span class="p">})</span><span class="x">
</span><span class="n">token</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">token</span><span class="o">.</span><span class="n">Error</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not publish"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<h2 id="device-activations">Device Activations</h2>

<p><strong>Topic:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/activations</code></p>

<p><strong>Message:</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"app_eui"</span><span class="err">:</span> <span class="s2">"0102030405060708"</span><span class="p">,</span> <span class="c1">// EUI of the application</span>
  <span class="s2">"dev_eui"</span><span class="err">:</span> <span class="s2">"0102030405060708"</span><span class="p">,</span> <span class="c1">// EUI of the device</span>
  <span class="s2">"dev_addr"</span><span class="err">:</span> <span class="s2">"26001716"</span><span class="p">,</span>        <span class="c1">// Assigned address of the device</span>
  <span class="s2">"metadata"</span><span class="err">:</span> <span class="p">{</span>
    <span class="c1">// Same as with Uplink Message</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Usage (Mosquitto):</strong> <code class="highlighter-rouge">mosquitto_sub -h &lt;Region&gt;.thethings.network:1883 -d -t 'my-app-id/devices/my-dev-id/events/activations'</code></p>

<p><strong>Usage (Go client):</strong></p>

<div class="language-go highlighter-rouge"><pre class="highlight"><code><span class="n">ctx</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">log</span><span class="o">.</span><span class="n">WithField</span><span class="p">(</span><span class="s">"Example"</span><span class="p">,</span><span class="x"> </span><span class="s">"Go Client"</span><span class="p">)</span><span class="x">
</span><span class="n">client</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">NewClient</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="x"> </span><span class="s">"ttnctl"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-access-key"</span><span class="p">,</span><span class="x"> </span><span class="s">"&lt;Region&gt;.thethings.network:1883"</span><span class="p">)</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">Connect</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not connect"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span><span class="n">token</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">client</span><span class="o">.</span><span class="n">SubscribeDeviceActivations</span><span class="p">(</span><span class="s">"my-app-id"</span><span class="p">,</span><span class="x"> </span><span class="s">"my-dev-id"</span><span class="p">,</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">client</span><span class="x"> </span><span class="n">Client</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">devID</span><span class="x"> </span><span class="kt">string</span><span class="p">,</span><span class="x"> </span><span class="n">req</span><span class="x"> </span><span class="n">Activation</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="c">// Do something with the activation</span><span class="x">
</span><span class="p">})</span><span class="x">
</span><span class="n">token</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span><span class="x">
</span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">token</span><span class="o">.</span><span class="n">Error</span><span class="p">();</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
  </span><span class="n">ctx</span><span class="o">.</span><span class="n">WithError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Could not subscribe"</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre>
</div>

<h2 id="device-events">Device Events</h2>

<h3 id="downlink-events">Downlink Events</h3>

<p><strong>Downlink Scheduled:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/down/scheduled</code><br />
payload: <em>null</em></p>

<p><strong>Downlink Sent:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/down/sent</code></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"payload"</span><span class="err">:</span> <span class="s2">"Base64 encoded LoRaWAN packet"</span><span class="p">,</span>
  <span class="s2">"gateway_id"</span><span class="err">:</span> <span class="s2">"some-gateway"</span><span class="p">,</span>
  <span class="s2">"config"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"modulation"</span><span class="err">:</span> <span class="s2">"LORA"</span><span class="p">,</span>
    <span class="s2">"data_rate"</span><span class="err">:</span> <span class="s2">"SF7BW125"</span><span class="p">,</span>
    <span class="s2">"counter"</span><span class="err">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s2">"frequency"</span><span class="err">:</span> <span class="mi">868300000</span><span class="p">,</span>
    <span class="s2">"power"</span><span class="err">:</span> <span class="mi">14</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>Downlink Acknowledgements:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/down/acks</code> <br />
payload: <em>null</em></p>

<h3 id="error-events">Error Events</h3>

<p>The payload of error events is a JSON object with the error’s description.</p>

<p><strong>Uplink Errors:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/up/errors</code><br />
<strong>Downlink Errors:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/down/errors</code><br />
<strong>Activation Errors:</strong> <code class="highlighter-rouge">&lt;AppID&gt;/devices/&lt;DevID&gt;/events/activations/errors</code></p>

<p>Example: <code class="highlighter-rouge"><span class="p">{</span><span class="nt">"error"</span><span class="p">:</span><span class="s2">"Activation DevNonce not valid: already used"</span><span class="p">}</span></code></p>

          </div>
        </section>
      
        
        
        <section class="panel">
          <div class="panel-body">
            <h1 id="migration-guide">Migration Guide</h1>

<p>This guide will walk you through migrating connections via MQTT from <code class="highlighter-rouge">staging.thethingsnetwork.org</code> to <code class="highlighter-rouge">&lt;Region&gt;.thethings.network</code>.</p>

<div class="alert alert-warning"><strong>Warning:</strong> The APIs for these versions of the library and backend might still change and the database (registered application and devices) reset. Do not use in production!</div>

<h2 id="region-specific-hostname">Region-specific hostname</h2>

<p>In staging you connected to <code class="highlighter-rouge">staging.thethingsnetwork.org</code>. Replace this with <code class="highlighter-rouge">&lt;Region&gt;.thethings.network</code>. See <a href="#credentials">Quick Start / Credentials</a> to learn what region to use. See the next section for a before/after example.</p>

<h2 id="application-eui-becomes-id">Application EUI becomes ID</h2>

<p>In staging you used the <strong>Application EUI</strong> as username and as first element in all topics. Replace this with the <strong>Application ID</strong>.</p>

<h3 id="staging">Staging</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h staging.thethingsnetwork.org -t <span class="s1">'#'</span> -u &lt;AppEUI -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
</div>

<h3 id="new">New</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_sub -h &lt;Region&gt;.thethings.network -t <span class="s1">'#'</span> -u <span class="s1">'&lt;AppID&gt;'</span> -P <span class="s1">'&lt;AppKey&gt;'</span> -v
</code></pre>
</div>

<h2 id="activations">Activations</h2>

<p>The topic has changed to <code class="highlighter-rouge">&lt;AppId&gt;/devices/&lt;DevId&gt;/events/activations</code>.</p>

<p>The JSON encoded payload has also changed on several points. Update the code where you process it.</p>

<h3 id="staging-1">Staging</h3>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datarate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"codingrate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateway_timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">3475324075</span><span class="p">,</span><span class="w">
    </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"server_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-12T14:00:16.614852216Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-42</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lsnr"</span><span class="p">:</span><span class="w"> </span><span class="mf">9.2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rfchain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"crc"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"altitude"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.90418</span><span class="p">,</span><span class="w">
    </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.95904</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="new-1">New</h3>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"app_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"70B3D57EF000001C"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0004A30B001B7AD2"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_addr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"26012723"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:02.90329585Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.5</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"coding_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateways"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1484146403</span><span class="p">,</span><span class="w">
      </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:02.867283Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-49</span><span class="p">,</span><span class="w">
      </span><span class="nt">"snr"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rf_chain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<blockquote>
  <p>Note that you now receive the Application EUI and the Device EUI and Address. Also, Gateway metadata can now be found in an array of all gateways that forwarded the activation.</p>
</blockquote>

<h2 id="uplink-payload">Up(link) payload</h2>

<p>The JSON encoded payload has changed on several points. Update the code where you process it.</p>

<h3 id="staging-2">Staging</h3>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dev_eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0004A30B001B7AD2"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">867.3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datarate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"codingrate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateway_timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">3662434019</span><span class="p">,</span><span class="w">
    </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="nt">"server_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-12T14:03:23.729350993Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-43</span><span class="p">,</span><span class="w">
    </span><span class="nt">"lsnr"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.8</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rfchain"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"crc"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gtw_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"altitude"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="nt">"longitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.90418</span><span class="p">,</span><span class="w">
    </span><span class="nt">"latitude"</span><span class="p">:</span><span class="w"> </span><span class="mf">52.95904</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="new-2">New</h3>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"payload_raw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"payload_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:08.179119279Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mf">868.3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"modulation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LORA"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SF7BW125"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"coding_rate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4/5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"gateways"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"eui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B827EBFFFE87BD22"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1489443003</span><span class="p">,</span><span class="w">
      </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-09-13T09:59:08.167028Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"channel"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rssi"</span><span class="p">:</span><span class="w"> </span><span class="mi">-49</span><span class="p">,</span><span class="w">
      </span><span class="nt">"snr"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
      </span><span class="nt">"rf_chain"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<blockquote>
  <p>Note that <code class="highlighter-rouge">payload</code> is now <code class="highlighter-rouge">payload_raw</code> and <code class="highlighter-rouge">fields</code> has been renamed to <code class="highlighter-rouge">payload_fields</code>. Also, <code class="highlighter-rouge">dev_eui</code> is no longer there and Gateway metadata can now be found in an array of all gateways that forwarded the activation.</p>
</blockquote>

<h2 id="downlink-payload">Down(link) payload</h2>

<p>The JSON encoded payload to send a message has also changed. Update the code where you compose the payload.</p>

<h3 id="staging-3">Staging</h3>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nt">"ttl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1h"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="new-3">New</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"payload_raw"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQ=="</span><span class="p">,</span><span class="w">
  </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<blockquote>
  <p>Note that <code class="highlighter-rouge">payload</code> has been renamed to <code class="highlighter-rouge">payload_raw</code> and <code class="highlighter-rouge">ttl</code> is no longer included. Also consider to use the new <a href="#downlink-fields"><code class="highlighter-rouge">payload_fields</code></a>.</p>
</blockquote>

          </div>
        </section>
      

    </div>

  </div>
</div>

<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom" /></a>
  </div>
</div>

    </div>

    <script src="/docs/assets/js/bundle.js"></script>
    <script src="https://www.thethingsnetwork.org/navbar.js"></script>
    <script src="https://ttnstaticfile.blob.core.windows.net/static/common/js/ga.js"></script>

  </body>
</html>
