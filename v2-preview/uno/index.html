<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --><!-- 20111122 0939 --><link rel="stylesheet" href="/docs/assets/css/main.css">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --><!-- WARNING: Respond.js doesn't work if you view the page via file:// --><!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]--><script>

    var site = {
      baseurl: '/docs',
      local: (document.location.port || document.location.protocol === 'file:')
    };

    (function(canonical) {
      if (!site.local && document.location.href.substr(0, document.location.href.length - document.location.hash.length) !== canonical) {
        window.location.replace(canonical);
      }
    })('https://www.thethingsnetwork.org/docs/v2-preview/uno/');

    </script><!-- Begin Jekyll SEO tag v2.1.0 --><title>The Things Uno - The Things Network</title>
<meta property="og:title" content="The Things Uno">
<meta name="description" content="The Things Uno is based off the Arduino Leonardo (not the Arduino Uno) with added Microchip LoRaWAN module. It is fully compatible with the Arduino IDE and existing shields.">
<meta property="og:description" content="The Things Uno is based off the Arduino Leonardo (not the Arduino Uno) with added Microchip LoRaWAN module. It is fully compatible with the Arduino IDE and existing shields.">
<link rel="canonical" href="https://www.thethingsnetwork.org/docs/v2-preview/uno/">
<meta property="og:url" content="https://www.thethingsnetwork.org/docs/v2-preview/uno/">
<meta property="og:site_name" content="The Things Network">
<meta property="og:image" content="https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-12-05T12:36:30+00:00">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@thethingsnetwrk">
<meta property="article:publisher" content="https://www.facebook.com/thethingsnetwork">
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "The Things Uno",
"image": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png",
"datePublished": "2016-12-05T12:36:30+00:00",
"description": "The Things Uno is based off the Arduino Leonardo (not the Arduino Uno) with added Microchip LoRaWAN module. It is fully compatible with the Arduino IDE and existing shields.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://www.thethingsnetwork.org/docs/assets/images/the-things-white.png"}},
"url": "https://www.thethingsnetwork.org/docs/v2-preview/uno/"}</script><!-- End Jekyll SEO tag --><link rel="apple-touch-icon-precomposed" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png">
<meta name="application-name" content="The Things Network">
<meta name="msapplication-tooltip" content="Building a Global Internet of Things Network Together.">
<meta name="msapplication-config" content="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/ieconfig.xml">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-32.png" sizes="32x32">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-57.png" sizes="57x57">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-76.png" sizes="76x76">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-96.png" sizes="96x96">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-120.png" sizes="120x120">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-128.png" sizes="128x128">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-144.png" sizes="144x144">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-152.png" sizes="152x152">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-180.png" sizes="180x180">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-195.png" sizes="195x195">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-228.png" sizes="228x228">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/smalltile.png" sizes="128x128">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/mediumtile.png" sizes="270x270">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/widetile.png" sizes="558x270">
<link rel="icon" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/largetile.png" sizes="558x558">
<link rel="shortcut icon" sizes="196x196" href="https://ttnstaticfile.blob.core.windows.net/static/common/favicon/favicon-196.png">
</head>
<body>

    <div id="content">
      










<div id="top" class="layout-guide container">

  <div class="row guide-nav">
    <div class="col-sm-9">
      <ol class="breadcrumb">
<li><a href="http://www.thethingsnetwork.org/">Home</a></li>
        <li><a href="/docs/">Learn</a></li>
        
        <li class="active">The Things Uno</li>
      </ol>
</div>
    <div class="col-sm-3 text-right">
      <a class="btn btn-default hidden-xs" href="http://github.com/TheThingsNetwork/docs/edit/master/_includes/v2-preview/uno.md" target="_blank"><i class="fa fa-pencil"></i> Improve this guide</a>
    </div>
  </div>

  <div class="row">

    <div class="col-md-3" role="complementary">

      <div class="guide-switch btn-group btn-block">
        <button type="button" class="btn btn-primary btn-block dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Guides <span class="caret"></span></button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
<li class="disabled"><a href="#">
              
              The Things Node
              
              </a></li>
            
              
                <li><a href="/docs/current/uno/">
              
              The Things Uno
              
              </a></li>
            
              
                <li><a href="/docs/current/arduino/">
              
              Arduino
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Devices
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li class="disabled"><a href="#">
              
              The Things Gateway
              
              </a></li>
            
              
                <li><a href="/docs/current/multitech/">
              
              MultiTech Conduit
              
              </a></li>
            
              
                <li><a href="/docs/current/lorrier/">
              
              Lorrier LR2
              
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Gateways
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li><a href="/docs/current/dashboard/">
              
              The Things Dashboard
              
              </a></li>
            
              
                <li><a href="/docs/current/cli/">
              
              The Things CLI
              
              </a></li>
            
              
                <li><a href="https://www.thethingsnetwork.org/wiki/Backend/Overview">
              
              Architecture
              
              </a></li>
            
          
            <li role="separator" class="divider">
            
              
                </li>
<li><a href="/docs/current/mqtt/">
              
              MQTT
              <span class="label label-info">API</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-js/">
              
              Node.js
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/current/node-red/">
              
              Node-RED
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li><a href="/docs/v2-preview/java/">
              
              Java
              <span class="label label-info">SDK</span>
              </a></li>
            
              
                <li class="disabled"><a href="#">
              
              Other Platforms
              
              </a></li>
            
          
        </ul>
</div>

      <div class="guide-sidebar hidden-xs hidden-sm">

        <div class="js-toc"></div>

        <p class="guide-top"><a href="#top">Back to top</a></p>

      </div>

    </div>

    <div class="col-md-9 js-toc-content content-body" role="main">

      
        <div class="alert alert-warning">
<strong>Attention:</strong> You are reading the <small>V2-PREVIEW</small> and not the <small><a href="/docs/current/uno/">CURRENT</a></small> version of this guide.  The UI and APIs might change and registered applications and devices might be deleted at any moment!</div>
      

      
      

      <section class="panel"><div class="panel-body">
          <span class="label label-success pull-right">V2-PREVIEW</span>
          <h1>The Things Uno</h1>
          <p><a href="https://shop.thethingsnetwork.com/index.php/product/the-things-uno/" target="_blank">The Things Uno</a> is based off the <a href="https://www.arduino.cc/en/Guide/ArduinoLeonardoMicro">Arduino Leonardo</a> (<a href="https://www.arduino.cc/en/Guide/ArduinoLeonardoMicro#toc9">not the Arduino Uno</a>) with added <a href="http://www.microchip.com/design-centers/wireless-connectivity/embedded-wireless/lora-technology">Microchip LoRaWAN module</a>. It is fully compatible with the <a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a> and existing shields.</p>

<p>It’s the perfect board to start prototyping your IoT ideas or make an existing project wireless with up to 10km range by simply swapping boards.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Access to <a href="https://preview.console.thethingsnetwork.org/">preview.console.thethingsnetwork.org</a>.</li>
  <li>The Things Uno beta board.</li>
  <li>Version 0.x of the <a href="https://github.com/thethingsnetwork/arduino-device-lib">The Things Network Arduino Library</a>.</li>
</ul>
</div>
        
          <div class="panel-footer">
            Versions:    
            
              <a href="/docs/current/uno/" class="label label-default">CURRENT: V1-STAGING</a>
            
            
              
              
            
              
              
                <a href="/docs/v2-preview/uno/" class="label label-success">V2-PREVIEW</a>
              
            
          </div>
        
      </section><section class="panel"><div class="panel-body">
            <h1 id="quick-start">Quick Start</h1>
<p>This guide will walk you through programming The Things Uno to send and receive your first message via The Things Network. We’ll use the <a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello, World!</a> of Arduino: <a href="https://www.arduino.cc/en/Reference/Constants"><code class="highlighter-rouge">LED_BUILTIN</code></a>. 💡</p>

<p>The full sketch comes with TheThingsNetwork library for the Arduino IDE as the <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/QuickStart/QuickStart.ino">QuickStart</a> example.</p>

<h2 id="setup-arduino-ide">Setup Arduino IDE</h2>
<p>Let’s start by setting up the software we’ll need to program your device.</p>

<ol>
<li>
<a href="https://www.arduino.cc/en/Main/Software">Download</a> and install the latest Arduino Software (IDE).</li>
  <li>Navigate to <strong>Sketch &gt; Include Library &gt; Manage Libraries…</strong>.</li>
  <li>Search for <strong>TheThingsNetwork</strong> and click the result to select it.</li>
  <li>Click the <strong>Install</strong> button which should appear:</li>
</ol>
<p><img src="arduino_library.png" alt="Library Manager"></p>

<p>The Arduino IDE will notify you of updates for the IDE and library automagically. <img class="emoji" title=":open_mouth:" alt=":open_mouth:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f62e.png" height="20" width="20" align="absmiddle"></p>

<blockquote>
  <p>See the <a href="/docs/v2-preview/arduino/">Arduino Guide</a> for more details.</p>
</blockquote>

<h2 id="connect-your-device">Connect your Device</h2>
<p>Next, connect your device to the IDE over USB.</p>

<ol>
<li>Use the included Micro-USB cable to connect The Things Uno to an USB port of your computer.</li>
  <li>In Arduino IDE select <strong>Tools &gt; Board &gt; Arduino Leonardo</strong>.</li>
  <li>Navigate to <strong>Tools &gt; Port</strong> and select the port that identifies as <strong>Arduino Leonardo</strong>.</li>
</ol>
<p>If you don’t see a port that identifies as <strong>Arduino Leonardo</strong> make sure The Things Uno’s power LED is on and check the cable and USB port you have used. See <a href="https://www.arduino.cc/en/Guide/Troubleshooting#toc16">Arduino Troubleshooting</a> for more suggestions.</p>

<h2 id="create-a-sketch">Create a Sketch</h2>
<p>Let’s program your device with a so-called sketch.</p>

<ol>
<li>
    <p>In the Arduino IDE, select <strong>File &gt; New</strong> <code class="highlighter-rouge">Ctrl/⌘ N</code>.</p>

    <p>This should get you the basic structure with <a href="https://www.arduino.cc/en/Reference/Setup"><code class="highlighter-rouge">setup()</code></a> and <a href="https://www.arduino.cc/en/Reference/Loop"><code class="highlighter-rouge">loop()</code></a>:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your setup code here, to run once:
</span>    	
<span class="p">}</span>
    	
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:
</span>    	
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Select <strong>Sketch &gt; Include Library &gt; TheThingsNetwork</strong>.</p>

    <p>This should prepend an <a href="https://www.arduino.cc/en/Reference/Include"><code class="highlighter-rouge">#include</code></a> for TheThingsNetwork library:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Let’s leave <code class="highlighter-rouge">loop()</code> for what it is and replace all code above it with the following:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="cp">#include &lt;TheThingsNetwork.h&gt;
</span>    
<span class="cp">#define loraSerial Serial1
#define debugSerial Serial
</span>    
<span class="n">TheThingsNetwork</span> <span class="n">ttn</span><span class="p">(</span><span class="n">loraSerial</span><span class="p">,</span> <span class="n">debugSerial</span><span class="p">,</span> <span class="cm">/* TTN_FP_EU868 or TTN_FP_US915 */</span><span class="p">);</span>
    
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">loraSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">57600</span><span class="p">);</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
    
  <span class="c1">// Wait a maximum of 10s for Serial Monitor
</span>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">debugSerial</span> <span class="o">&amp;&amp;</span> <span class="n">millis</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">);</span>
    
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"-- STATUS"</span><span class="p">);</span>
  <span class="n">ttn</span><span class="p">.</span><span class="n">showStatus</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
    </div>

    <blockquote>
      <p>Replace <code class="highlighter-rouge">/* TTN_FP_EU868 or TTN_FP_US915 */</code> with either <code class="highlighter-rouge">TTN_FP_EU868</code> or <code class="highlighter-rouge">TTN_FP_US915</code> depending on the frequency plan of your device.</p>
    </blockquote>

    <p>This will do a few things:</p>

    <ol>
<li>Use <a href="https://www.arduino.cc/en/Reference/Define"><code class="highlighter-rouge">#define</code></a> to create more meaningful aliases for the <a href="https://www.arduino.cc/en/Reference/Serial"><code class="highlighter-rouge">Serial</code></a> ports that connect the LoRa modem and USB.</li>
      <li>Create an instance <code class="highlighter-rouge">ttn</code> of TheThingsNetwork class, passing the serial ports of the LoRa module and USB connection.</li>
      <li>Call <a href="https://www.arduino.cc/en/Serial/Begin"><code class="highlighter-rouge">begin()</code></a> to set the data rate for both serial ports.</li>
      <li>
        <p>Wait for the Arduino IDE’s Serial Monitor to open communication via USB, but no longer than 10 seconds (10.000ms).</p>

        <blockquote>
          <p>This trick works because <a href="https://www.arduino.cc/en/Serial/IfSerial"><code class="highlighter-rouge">if(Serial)</code> will return <code class="highlighter-rouge">true</code></a> when communication is open and <a href="https://www.arduino.cc/en/Reference/Millis"><code class="highlighter-rouge">millis()</code></a> will give us the time since <code class="highlighter-rouge">setup()</code> was called.</p>
        </blockquote>
      </li>
      <li>Use <a href="https://www.arduino.cc/en/Serial/Println"><code class="highlighter-rouge">println()</code></a> to log to the Serial Monitor and call <code class="highlighter-rouge">ttn.showStatus()</code> to do the same, which will give us the information we need for our next step.</li>
    </ol>
</li>
</ol>
<h2 id="get-your-device-eui">Get your Device EUI</h2>
<p>To communicate via The Things Network, you need to register your device. For this, we’ll need its unique <strong>Device EUI</strong>. This is a unique address, hard coded into the LoRa module. The <code class="highlighter-rouge">ttn.showStatus()</code> method we added in the previous step will get us this and other information about our device.</p>

<ol>
<li>
    <p>In the Arduino IDE, select <strong>Sketch &gt; Upload</strong> <code class="highlighter-rouge">Ctrl/⌘ U</code> to upload the sketch.</p>

    <blockquote>
      <p>Uploads might fail if the Serial Monitor is open or if the IDE lost track of <a href="#connect-your-device">the port you selected</a>. Close the monitor, check the port selection and try again. If it still fails, check <a href="https://www.arduino.cc/en/Guide/Troubleshooting#toc1">Arduino Troubleshooting</a>.</p>
    </blockquote>
  </li>
  <li>
    <p>Within 10 seconds, select <strong>Tools &gt; Serial Monitor</strong> <code class="highlighter-rouge">Ctrl/⌘ Shift M</code> to open the <a href="https://www.arduino.cc/en/Guide/Environment#toc12">Serial Monitor</a>.</p>

    <p>Soon, it should print a list of information:</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>-- STATUS
EUI: 0004A30B001B7AD2
Battery: 3223
AppEUI: 70B3D57EF000001C
DevEUI: 0004A30B001B7AD2
Data Rate: 5
RX Delay 1: 1000
RX Delay 2: 2000
</code></pre>
    </div>

    <p>Use the first <code class="highlighter-rouge">EUI</code> value to register your device.</p>
  </li>
</ol>
<blockquote>
  <p>Next time you need the Device EUI of a device, simply select <strong>File &gt; Examples &gt; TheThingsNetwork &gt; <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/DeviceInfo/DeviceInfo.ino">DeviceInfo</a></strong> and upload this sketch that will call <code class="highlighter-rouge">ttn.showStatus()</code> every 10 seconds from <code class="highlighter-rouge">loop()</code>.</p>
</blockquote>

<p>🎉 You have connected your device, written your first sketch, uploaded it to your device and retrieved its logs!</p>

<h2 id="create-an-account">Create an Account</h2>
<p>To register your device you’ll need a The Things Network account.</p>

<ol>
<li>
    <p>Go to <a href="https://preview.account.thethingsnetwork.org">preview.account.thethingsnetwork.org</a> and click <a href="https://preview.account.thethingsnetwork.org/register">create an account</a>.</p>

    <blockquote>
      <p>You can change all of this, including e-mail address and username later via your <a href="https://preview.account.thethingsnetwork.org/users/profile">Profile</a>.</p>
    </blockquote>
  </li>
  <li>Check your mailbox to validate your e-mail address.</li>
  <li>Go to <a href="http://preview.console.thethingsnetwork.org">preview.console.thethingsnetwork.org</a> and log in.</li>
  <li>From the top right menu, select <a href="https://preview.console.thethingsnetwork.org/settings">Settings</a> and change the default (handler) region if the one currently selected is not near where you’ll be deploying your devices.</li>
</ol>
<h2 id="add-an-application">Add an Application</h2>
<p>Devices need to be registered with an application to communicate with. Let’s add one.</p>

<ol>
<li>
    <p>On <a href="https://preview.console.thethingsnetwork.org/">preview.console.thethingsnetwork.org</a>, click <a href="https://preview.console.thethingsnetwork.org/applications/add">add application</a>.</p>

    <ul>
<li>For <strong>Application ID</strong>, choose a unique ID of lower case, alphanumeric characters and nonconsecutive <code class="highlighter-rouge">-</code> and <code class="highlighter-rouge">_</code>.</li>
      <li>For <strong>Application Description</strong>, enter anything you like.</li>
      <li>Leave the checkbox enabled to automatically register the application to your default region.</li>
    </ul>
<p><img src="add-application.png" alt="Add Application"></p>
  </li>
  <li>
    <p>Click <strong>Add Application</strong> to finish.</p>

    <p>You will be redirected to the newly added application.</p>
  </li>
</ol>
<h2 id="register-your-device">Register your Device</h2>
<p>You are now ready to register your device to the application.</p>

<ol>
<li>On the application screen, select <strong>Devices</strong> from the top right menu.</li>
  <li>
    <p>In the <strong>Devices</strong> box, click <strong>register device</strong>.</p>

    <ul>
<li>For <strong>Device ID</strong>, choose a - for this application - unique ID of lower case, alphanumeric characters and nonconsecutive <code class="highlighter-rouge">-</code> and <code class="highlighter-rouge">_</code>.</li>
      <li>For <strong>Device EUI</strong>, copy-paste the <strong>DevEUI</strong> <a href="#get-your-device-eui">you retrieved from your device</a>.</li>
      <li>Leave the <strong>App Key</strong> to be randomly generated.</li>
      <li>For <strong>App EUI</strong>, select the generated EUI of our application from the list.</li>
    </ul>
<p><img src="register-device.png" alt="Register Device (OTAA)"></p>
  </li>
  <li>
    <p>Click <strong>Register</strong> to finish.</p>

    <p>You will be redirected to the newly registered device, where you can find the generated <strong>App Key</strong> which we’ll need next.</p>
  </li>
</ol>
<h2 id="activate-your-device">Activate your Device</h2>
<p>Now that we have registered the device, we can activate the connection from our device itself.</p>

<blockquote>
  <p>Activation means that the device will use the generated App Key to negotiate session keys for further communication. This is also known as Over The Air Activation or OTAA. There’s also <a href="../console/#personalise-device-for-abp">Activation By Personalisation</a> (ABP) where you set or generate the session keys via the console and hard-code them on your device.</p>
</blockquote>

<ol>
<li>
    <p>In the Arduino IDE, go back to your sketch and copy-paste the following lines just after the <code class="highlighter-rouge">#include</code>:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appEui</span> <span class="o">=</span> <span class="s">"0000000000000000"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">appKey</span> <span class="o">=</span> <span class="s">"00000000000000000000000000000000"</span><span class="p">;</span>
</code></pre>
    </div>
  </li>
  <li>Replace the values for <code class="highlighter-rouge">appEUI</code> and <code class="highlighter-rouge">appKey</code> with the <strong>Application EUI</strong> and <strong>App Key</strong> found under <strong>Device Overview</strong> on your device screen in the console.</li>
  <li>
    <p>In the <code class="highlighter-rouge">setup()</code> function, copy the following code just after <code class="highlighter-rouge">ttn.showStatus()</code>:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"-- JOIN"</span><span class="p">);</span>
<span class="n">ttn</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">appEui</span><span class="p">,</span> <span class="n">appKey</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Select <strong>Sketch &gt; Upload</strong> <code class="highlighter-rouge">Ctrl/⌘ U</code> to upload the sketch and then <strong>Tools &gt; Serial Monitor</strong> <code class="highlighter-rouge">Ctrl/⌘ Shift M</code> to open the Serial Monitor.</p>

    <p>You should see something like:</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>-- STATUS
EUI: 0004A30B001B7AD2
Battery: 3223
AppEUI: 70B3D57EF000001C
DevEUI: 0004A30B001B7AD2
DevAddr: 260127C6
Data Rate: 5
RX Delay 1: 1000
RX Delay 2: 2000
-- JOIN
Version is RN2483 1.0.1 Dec 15 2015 09:38:09, model is RN2483
Sending: mac set adr off
Sending: mac set pwridx 1
Sending: mac set dr 5
Sending: mac set appeui with 8 bytes
Sending: mac set deveui 0004A30B001B7AD2
Sending: mac set appkey with 16 bytes
Sending: mac join otaa
Join accepted. Status: 00000401
DevAddr: 26012E93
</code></pre>
    </div>
  </li>
</ol>
<p>🎉 Your device is now activated and connected to The Things Network!</p>

<h2 id="message-the-application">Message the application</h2>
<p>Let’s say hello! Most Arduino boards have an on-board LED and the constant <a href="https://www.arduino.cc/en/Reference/Constants"><code class="highlighter-rouge">LED_BUILTIN</code></a> (scroll all the way down) will tell us to which pin it is connected. We are going send a message to tell us if it’s on or not. Exciting! 💡</p>

<ol>
<li>
    <p>In the Arduino IDE, go back to your sketch and replace the <code class="highlighter-rouge">loop()</code> function with:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"-- LOOP"</span><span class="p">);</span>
    
  <span class="c1">// Prepare array of 1 byte to indicate LED status
</span>  <span class="n">byte</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    
  <span class="c1">// Send it off
</span>  <span class="n">ttn</span><span class="p">.</span><span class="n">sendBytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
      
  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
    </div>

    <p>This will do a few things:</p>

    <ol>
<li>
        <p>Create an <a href="https://www.arduino.cc/en/Reference/Array">array</a> of <a href="https://www.arduino.cc/en/Reference/byte">bytes</a> to hold our message.</p>

        <blockquote>
          <p>With LoRaWAN, airtime is expensive. The bigger the message, the more airtime it will cost. Encode any message you need to send in as little bytes as you can.</p>
        </blockquote>
      </li>
      <li>
        <p>Use <a href="https://www.arduino.cc/en/Reference/DigitalRead"><code class="highlighter-rouge">digitalRead</code></a> to get the current value of the LED pin. This will be either <a href="https://www.arduino.cc/en/Reference/Constants">constants</a> <code class="highlighter-rouge">HIGH</code> or <code class="highlighter-rouge">LOW</code>, which we translate to <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">0</code>.</p>
      </li>
      <li>
        <p>Call <code class="highlighter-rouge">ttn.sendBytes()</code> to send the message. This takes the array itself as well as its length via <a href="https://www.arduino.cc/en/Reference/Sizeof"><code class="highlighter-rouge">sizeof()</code></a>.</p>

        <blockquote>
          <p>Can’t <code class="highlighter-rouge">sendBytes()</code> figure out the length you’re asking? The short answer: no. For a longer answer, check <a href="http://stackoverflow.com/a/8464659">Stack Overflow</a>.</p>
        </blockquote>
      </li>
      <li>
        <p>Pause 10 seconds between loops.</p>
      </li>
    </ol>
</li>
  <li>
    <p>Select <strong>Sketch &gt; Upload</strong> <code class="highlighter-rouge">Ctrl/⌘ U</code> to upload the sketch and then <strong>Tools &gt; Serial Monitor</strong> <code class="highlighter-rouge">Ctrl/⌘ Shift M</code> to open the Serial Monitor.</p>

    <p>You should see something like:</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>-- LOOP
Sending: mac tx uncnf 1 with 1 bytes
Successful transmission
</code></pre>
    </div>
  </li>
</ol>
<h2 id="monitor--decode-messages">Monitor &amp; Decode Messages</h2>
<p>Let’s see the messages come in.</p>

<ol>
<li>
    <p>From the application’s screen in the console, select <strong>Data</strong> from the top right menu.</p>

    <p>You should now see the messages come in:</p>

    <p><img src="console-data.png" alt="Application Data"></p>

    <p>What you see is the raw payload in hex-formatted, space-separated bytes. Let’s decode that to meaningful fields.</p>
  </li>
  <li>Select <strong>Payload Functions</strong> from the top right menu.</li>
  <li>
    <p>Leave <strong>decoder</strong> selected and copy-paste <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/QuickStart/Decoder.js">the following JavaScript code</a>:</p>

    <div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">function</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Decode an uplink message from a buffer</span>
  <span class="c1">// (array) of bytes to an object of fields.</span>
  <span class="kd">var</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="p">{};</span>
        
  <span class="k">if</span> <span class="p">(</span><span class="nx">port</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">decoded</span><span class="p">.</span><span class="nx">led</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        
  <span class="k">return</span> <span class="nx">decoded</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Use the input field and <strong>Test</strong> button to see how various payloads of hex-formatted, space-separated bytes are decoded by selecting the first byte (as number) for a field called <code class="highlighter-rouge">led</code>:</p>

    <ul>
<li>
<code class="highlighter-rouge">00</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">01</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">FF</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">01 02 03</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span></code>
</li>
    </ul>
</li>
  <li>
    <p>Now select <strong>converter</strong> and copy-paste <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/QuickStart/Converter.js">the following code</a>:</p>

    <div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">function</span> <span class="nx">Converter</span><span class="p">(</span><span class="nx">decoded</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Merge, split or otherwise</span>
  <span class="c1">// mutate decoded fields.</span>
  <span class="kd">var</span> <span class="nx">converted</span> <span class="o">=</span> <span class="nx">decoded</span><span class="p">;</span>
        
  <span class="k">if</span> <span class="p">(</span><span class="nx">port</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">converted</span><span class="p">.</span><span class="nx">led</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">converted</span><span class="p">.</span><span class="nx">led</span> <span class="o">===</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">converted</span><span class="p">.</span><span class="nx">led</span> <span class="o">=</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">converted</span><span class="p">.</span><span class="nx">led</span><span class="p">);</span>
  <span class="p">}</span>
        
  <span class="k">return</span> <span class="nx">converted</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Again, test with various bytes to how the decoded object gets converted to more meaningful values:</p>

    <ul>
<li>
<code class="highlighter-rouge">00</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">01</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">FF</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="p">}</span></code>
</li>
      <li>
<code class="highlighter-rouge">01 02 03</code> becomes <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span></code>
</li>
    </ul>
</li>
  <li>
    <p>Next, select <strong>validator</strong> and paste <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/QuickStart/Validator.js">this code</a>:</p>

    <div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">function</span> <span class="nx">Validator</span><span class="p">(</span><span class="nx">converted</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Return false if the decoded, converted</span>
  <span class="c1">// message is invalid and should be dropped.</span>
        
  <span class="k">if</span> <span class="p">(</span><span class="nx">port</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">converted</span><span class="p">.</span><span class="nx">led</span> <span class="o">!==</span> <span class="s1">'boolean'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
        
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Run another round of tests to verify all payloads that don’t convert to have a boolean <code class="highlighter-rouge">led</code> property are marked invalid:</p>

    <p><img src="console-validator.png" alt="Validator"></p>

    <p>Invalid messages will be dropped and not published to services that have subscribed to this application’s messages.</p>
  </li>
  <li>
    <p>Click <strong>Save Payload Functions</strong> to save all three in one go.</p>
  </li>
  <li>
    <p>Select <strong>Data</strong> from the top right menu.</p>
  </li>
  <li>
    <p>If your device is still sending data any (valid) new messages should now show their decoded and converted payload in the <strong>fields</strong> column:</p>

    <p><img src="console-data-decoded.png" alt="Decoded"></p>
  </li>
</ol>
<p>🎉 You can now decode cryptic byte messages to meaningful payloads!</p>

<blockquote>
  <p>Would you like to learn how to receive and further process these messages? Head over to the <a href="/docs/v2-preview/mqtt">MQTT</a> guide!</p>
</blockquote>

<h2 id="message-your-device">Message your device</h2>
<p>Now let’s send a message to your device in return.</p>

<blockquote>
  <p>There are different <a href="https://www.lora-alliance.org/What-Is-LoRa/Technology">classes of LoRa devices</a>. Like most devices, The Things Uno and Node can only receive the single last message queued for them in response to a message they send themselves.</p>
</blockquote>

<p>We’ll prepare your device to receive a message in response.</p>

<ol>
<li>
    <p>In the Arduino IDE, add the following line to <code class="highlighter-rouge">setup()</code> function to let it know what function to call when a message comes in:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="c1">// Set callback for incoming messages
</span><span class="n">ttn</span><span class="p">.</span><span class="n">onMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Then copy paste the actual function to the end of the sketch:</p>

    <div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">void</span> <span class="nf">message</span><span class="p">(</span><span class="k">const</span> <span class="n">byte</span><span class="o">*</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"-- MESSAGE"</span><span class="p">);</span>
    
  <span class="c1">// Only handle messages of a single byte
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
    
  <span class="k">if</span> <span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"LED: off"</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
          
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">debugSerial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"LED: on"</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
    </div>

    <p>The function will use <a href="https://www.arduino.cc/en/Reference/DigitalWrite"><code class="highlighter-rouge">digitalWrite()</code></a> to turn the LED on or off, based on the single byte message we receive.</p>
  </li>
  <li>Select <strong>Sketch &gt; Upload</strong> <code class="highlighter-rouge">Ctrl/⌘ U</code> to upload the sketch and then <strong>Tools &gt; Serial Monitor</strong> <code class="highlighter-rouge">Ctrl/⌘ Shift M</code> to open the serial monitor.</li>
  <li>In the console, navigate to your application, <strong>Devices</strong> and select your device.</li>
  <li>
    <p>With the serial monitor still open, enter <code class="highlighter-rouge">01</code> in the input field of the <strong>Downlink</strong> box and click <strong>Send</strong>.</p>

    <p>The next time your device sends a message it should display something like:</p>

    <div class="highlighter-rouge">
<pre class="highlight"><code>-- LOOP
Sending: mac tx uncnf 1 with 1 bytes
Successful transmission. Received 1 bytes
LED: on
</code></pre>
    </div>

    <p>And… there was light! 💡</p>

    <p><img src="led_on.jpg" alt="The Things Uno with LED on"></p>
  </li>
  <li>
    <p>From the device screen, select <strong>Data</strong> from the top right menu and you should see that the next message the device sends indeed confirms the LED is now on:</p>

    <p><img src="console-data-on.png" alt="Message led:true"></p>
  </li>
  <li>As a bonus, try sending <code class="highlighter-rouge">00</code> to turn of the LED and verify that the next message confirms it.</li>
</ol>
<p>🎉 Congrats! You just closed the circle and can communicate via The Things Network in both ways.</p>

<h2 id="encode-messages">Encode Messages</h2>
<p>What would be cooler than turning a LED on by sending <code class="highlighter-rouge">00</code>? Sending <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span></code> of course! Just like we decode message on arrival on The Things Network we can also encode messages to devices before they will be delivered.</p>

<ol>
<li>In the console, navigate to the application and select <strong>Payload Functions</strong> from the top right menu.</li>
  <li>
    <p>Select <strong>encoder</strong> and use <a href="https://github.com/TheThingsNetwork/arduino-device-lib/blob/master/examples/QuickStart/Encoder.js">the following code</a>:</p>

    <div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">function</span> <span class="nx">Encoder</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Encode downlink messages sent as</span>
  <span class="c1">// object to an array or buffer of bytes.</span>
  <span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">[];</span>
        
  <span class="k">if</span> <span class="p">(</span><span class="nx">port</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">object</span><span class="p">.</span><span class="nx">led</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
        
  <span class="k">return</span> <span class="nx">bytes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Use the input field and <strong>Test</strong> button to see how various <a href="http://www.json.org">JSON encoded</a> payloads will be encoded as displayed in hex-formatted, space-separated bytes:</p>

    <ul>
<li>
<code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span></code> becomes <code class="highlighter-rouge">00</code>
</li>
      <li>
<code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span></code> becomes <code class="highlighter-rouge">01</code>
</li>
      <li>
<code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"foo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w"> </span><span class="p">}</span></code> becomes ` ` (nothing)</li>
    </ul>
<blockquote>
      <p>There is no separate converter and validator function for this direction. Return an empty array to drop the message.</p>
    </blockquote>
  </li>
  <li>Click <strong>Save Payload Functions</strong>.</li>
  <li>Select <strong>Devices</strong> from the top right menu and select your device.</li>
  <li>
    <p>With the serial monitor still open, select <strong>fields</strong> in the <strong>Downlink</strong> box, enter <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"led"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span></code> in the input field and click <strong>Send</strong>.</p>

    <p>You should now see the LED turn on again and be able to verify in the logs and console data monitor. Don’t forget to try <code class="highlighter-rouge">true</code> as well, you never know! 😉</p>
  </li>
</ol>
<p>🙌 You have now completed the Quick Start and are able to send messages, decode, convert and validate them and respond with encoded messages. Go build something!</p>

<h2 id="whats-next">What’s next?</h2>

<p>Next, you’ll want to:</p>

<ol>
<li>Learn how to receive and send messages from anywhere using <a href="/docs/v2-preview/mqtt">MQTT</a> or our <a href="../node-red/#quick-start">Node-RED</a> or <a href="/docs/v2-preview/node-js/#quick-start">Node.js</a> library.</li>
  <li>
    <p>Learn how to add sensors and actuators to your device to harvest data and trigger actions anywhere, thanks to the long range, low power The Things Network.</p>

    <p>Let <a href="https://www.thethingsnetwork.org/labs/stories?search=&amp;c2=on&amp;c3=on&amp;c4=on&amp;c5=on">The Things Lab</a> inspire you!</p>

    <blockquote>
      <p>We’ll have a guide on encoding and decoding sensor and actuator data for efficient communication soon.</p>
    </blockquote>
  </li>
</ol>
</div>
        </section><section class="panel"><div class="panel-body">
            <h1 id="working-with-bytes">Working with bytes</h1>
<p>To send data back and forth over The Things Network you’ll need to use bytes. This guide will help you encode different types of data in as little bytes possible.</p>

<blockquote>
  <p>The unprecedented range of the LoRaWAN technology we build on comes at the cost of low bandwidth and limited airtime (the number times size of packages you send). Fortunately, you don’t need a picture of that smart garage bin that needs to emptied. Even a single bit <code class="highlighter-rouge">1</code> would do!</p>
</blockquote>

<h2 id="what-is-a-byte">What is a byte?</h2>
<p>A <a href="https://simple.wikipedia.org/wiki/Byte">byte</a> is a group of 8 bits. A bit is the most basic unit and can be either 1 or 0. A byte is not just 8 values between 0 and 1, but 256 (2<sup>8</sup>) different combinations (rather <a href="https://www.mathsisfun.com/combinatorics/combinations-permutations.html">permutations</a>) ranging from <code class="highlighter-rouge">00000000</code> via e.g. <code class="highlighter-rouge">01010101</code> to <code class="highlighter-rouge">11111111</code>. Thus, one byte can represent a <a href="https://simple.wikipedia.org/wiki/Decimal">decimal</a> number between 0(00) and 255.</p>

<blockquote>
  <p>Puzzled? Remember that 3 decimal numbers also don’t just stand for 3 values between 0 and 9, but 1000 (10<sup>3</sup>) permutations from 0(00) to 999.</p>
</blockquote>

<p>Learn more on <a href="http://computer.howstuffworks.com/bytes.htm">How Stuff Works: How Bits and Bytes Work</a> and the <a href="http://playground.arduino.cc/Code/BitMath">Arduino Bit Math Tutorial</a> to learn more about it.</p>

<h2 id="what-is-a-buffer-of-bytes">What is a buffer of bytes?</h2>
<p>Think of <em>buffer</em> as just another word for an <em>array</em>, <em>list</em>, whatever resonates with your programming experience. Like a byte is a group of 8 bits, a <a href="https://en.wikipedia.org/wiki/Data_buffer">buffer</a> is a group of a pre-defined number of bytes. If we have a group of 3 bytes, this could either represent 3 values between 0 and 255, but also one single value between 0 and 16777216 (256<sup>3</sup>).</p>

<blockquote>
  <p>See the pattern? The number of choices per position (n) to the power of the number of positions (r) is the number of permutations: n<sup>r</sup>. Learn more on <a href="https://www.mathsisfun.com/combinatorics/combinations-permutations.html">MathIsFun.com</a>.</p>
</blockquote>

<h2 id="what-the-hex">What the hex?</h2>
<p>Often, you’ll see a group of bytes displayed as:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>FF F0 0F 11
</code></pre>
</div>

<p>Wasn’t a byte a group of 8 <code class="highlighter-rouge">0</code>s and <code class="highlighter-rouge">1</code>s? 🤔 You’re totally right, but just like we already saw <code class="highlighter-rouge">11111111</code> translates to 255 in the good old decimal system, we can also translate it to FF in the <a href="https://simple.wikipedia.org/wiki/Hexadecimal_numeral_system">hexadecimal system</a> where each position has 16 (0-9 A-F) possible values. The advantage is that it is shorter and explicit about the maximum value (257 is not an option).</p>

<p>The above example <a href="https://www.mathsisfun.com/binary-decimal-hexadecimal-converter.html">translated</a> to the decimal system and padded for readability would be:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>255 240 015 017
</code></pre>
</div>

<p>To indicate that you mean <code class="highlighter-rouge">11</code> in hex and not two bits or the number eleven, you prefix it with the <code class="highlighter-rouge">0x</code> formatter. To tell it you mean binary use <code class="highlighter-rouge">B</code>.</p>

<table class="table">
<thead><tr>
<th>Code</th>
      <th>Byte value</th>
      <th>Decimal value</th>
      <th>Hexadecimal value</th>
    </tr></thead>
<tbody>
<tr>
<td><code class="highlighter-rouge">11</code></td>
      <td>00001011</td>
      <td>11</td>
      <td>B</td>
    </tr>
<tr>
<td><code class="highlighter-rouge">0x11</code></td>
      <td>00010001</td>
      <td>17</td>
      <td>11</td>
    </tr>
<tr>
<td><code class="highlighter-rouge">B11</code></td>
      <td>00000011</td>
      <td>3</td>
      <td>3</td>
    </tr>
</tbody>
</table>
<p>An example for Arduino:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">byte</span> <span class="n">data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">};</span>
<span class="c1">// identical: { 255, 240, 15, 17 };
// identical: { B11111111, B11110000, B00001111, B00010001 };
</span><span class="n">ttn</span><span class="p">.</span><span class="n">sendBytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
</code></pre>
</div>

<p>Yeah, I know… <code class="highlighter-rouge">0x</code> kind of blows the shorter-to-write advantage of hex. 🙃</p>

<h2 id="how-many-bytes-can-i-send">How many bytes can I send?</h2>
<p>Technically, you can send 51 bytes. But, the more bytes you’ll send, the more airtime the package will cost you and the sooner you’ll hit your maximum allotted time. So, don’t ask yourself how many you can possibly send but rather ask how few could do the job.</p>

<h2 id="how-to-send-big-numbers">How to send big numbers?</h2>
<p>A better question would be how to send ranges bigger than 255.</p>

<h3 id="index">1. Index</h3>
<p>If the possible values you’d need to support don’t start at 0 and you know the minimum value, start by indexing on that number.</p>

<p>For example, imagine we’d expect values between 3400 and 3600.</p>

<p>On the device we’d encode this as:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">myVal</span> <span class="o">=</span> <span class="mi">3450</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">myBase</span> <span class="o">=</span> <span class="mi">3400</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">myVal</span> <span class="o">-</span> <span class="n">myBase</span> <span class="p">};</span>
</code></pre>
</div>

<p>And in the application payload functions do:</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">var</span> <span class="nx">myBase</span> <span class="o">=</span> <span class="mi">3400</span><span class="p">;</span>
<span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">myBase</span><span class="p">;</span>
</code></pre>
</div>

<p>The other way around, in the application encoder payload function we would have:</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">var</span> <span class="nx">myVal</span> <span class="o">=</span> <span class="mi">3450</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">myBase</span> <span class="o">=</span> <span class="mi">3400</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">[</span><span class="nx">myVal</span> <span class="o">-</span> <span class="nx">myBase</span><span class="p">];</span>
</code></pre>
</div>

<p>And on the device decode this with:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">myBase</span> <span class="o">=</span> <span class="mi">3400</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">myVal</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">myBase</span><span class="p">;</span>
</code></pre>
</div>

<p>As you can see as long as the minimum value is known and the range of our value is 256 or less, we can still use a single byte without breaking a sweat. 😅</p>

<h3 id="round">2. Round</h3>
<p>Now what if the range is bigger than 256? The next question would be if you need to know the exact value. If your sensor has a range of 400 and an error margin of 2, you wouldn’t lose any meaning by rounding the value. Both 299 and 300 would round to 150, which is fine.</p>

<p>On the device we’d encode this as:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">myVal</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">errorMargin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">round</span><span class="p">(</span><span class="n">myVal</span> <span class="o">/</span> <span class="n">errorMargin</span><span class="p">)</span> <span class="p">};</span>
</code></pre>
</div>

<p>And in the application payload functions do:</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">var</span> <span class="nx">errorMargin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">errorMargin</span><span class="p">;</span>
</code></pre>
</div>

<p>You’ll get the idea for the other way around.</p>

<h3 id="use-words">3. Use words</h3>

<p>A <a href="https://www.arduino.cc/en/Reference/Word">word</a> is 2 bytes, which already gets you a huge range of 65536 (256<sup>2</sup>). The <a href="https://www.arduino.cc/en/Reference/Int">int</a> data type is a word and Arduino comes with <a href="https://www.arduino.cc/en/Reference/HighByte"><code class="highlighter-rouge">highByte()</code></a> and <a href="https://www.arduino.cc/en/Reference/LowByte"><code class="highlighter-rouge">lowByte()</code></a> to extract the left and right byte from a word. This makes it really easy to encode and decode.</p>

<p>Encode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">myVal</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">highByte</span><span class="p">(</span><span class="n">myVal</span><span class="p">);</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowByte</span><span class="p">(</span><span class="n">myVal</span><span class="p">);</span>
</code></pre>
</div>

<p>Decode (payload functions):</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
               <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</code></pre>
</div>

<blockquote>
  <p>Wondering what the <code class="highlighter-rouge">&lt;&lt;</code> is about? This <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Left_shift">Left shifts</a> the 8 bits of the first byte 8 positions to the left. Confused? Think about how we could encode the number 11 as two 1’s and decode by shifting the first 1 up one position (making it 10) before adding the other. We’ll talk more about bit shifting next.</p>
</blockquote>

<p>Encode (payload functions):</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="kd">var</span> <span class="nx">myVal</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">myVal</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
<span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">myVal</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
</code></pre>
</div>

<blockquote>
  <p>Never seen <code class="highlighter-rouge">&amp;</code> used this way before? This is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Bitwise_AND">Bitwise AND</a>. Used this way the right side of the expression will act as a <a href="https://en.wikipedia.org/wiki/Mask_(computing)">mask</a> to zero out one byte so we can work with just the other one.</p>
</blockquote>

<p>Decode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">int</span> <span class="n">myVal</span> <span class="o">=</span> <span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
           <span class="o">+</span> <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</code></pre>
</div>

<h3 id="shift-bits">4. Shift bits</h3>

<p>If the range of expected values is bigger than 65536 we can use the same trick. The only difference is that we have to manually shift bits when we encode on Arduino, just like we did in the payload function.</p>

<p>Let’s say we need to encode a <a href="https://www.arduino.cc/en/Reference/Long">long</a> which uses 4 bytes for a range up to 4294967296.</p>

<p>Encode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">long</span> <span class="n">lng</span> <span class="o">=</span> <span class="mi">200000L</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">lng</span> <span class="o">&amp;</span> <span class="mh">0xFF000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span> <span class="p">);</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">lng</span> <span class="o">&amp;</span> <span class="mh">0x00FF0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="p">);</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">lng</span> <span class="o">&amp;</span> <span class="mh">0x0000FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>  <span class="p">);</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">lng</span> <span class="o">&amp;</span> <span class="mh">0X000000FF</span><span class="p">)</span>       <span class="p">);</span>
</code></pre>
</div>

<p>Decode (payload functions):</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</code></pre>
</div>

<h2 id="how-to-send-negative-numbers">How to send negative numbers?</h2>

<p>To tell the difference between -100 and 100 you will need a <a href="https://en.wikipedia.org/wiki/Signed_number_representations">signed</a> data type. These set the highest (left-most) bit to <code class="highlighter-rouge">1</code> to indicate it’s a negative number. This does mean that for example in a word only 15 of the 16 bits are available for the actual number, limiting the range from 65536 to 32768.</p>

<h3 id="index-round-and-shift">Index, round and shift</h3>

<p>The data types we used so far are all signed, which means all of the tricks work just as well for negative values. Just be aware of the maximum value.</p>

<h3 id="unsigned-data-types">Unsigned data types</h3>

<p>If you don’t expect negative numbers and need a bigger range, explicitly use <a href="https://www.arduino.cc/en/Reference/UnsignedInt"><code class="highlighter-rouge">unsigned int</code></a> or <a href="https://www.arduino.cc/en/Reference/UnsignedLong"><code class="highlighter-rouge">unsigned long</code></a>.</p>

<h2 id="how-to-send-decimals">How to send decimals?</h2>

<p>So far we have only dealt with rounded numbers. What if you need more precision? The answer very similar to how we indexed or rounded big numbers. Simply multiple and divide the value as you encode and decode it.</p>

<p>Encode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">float</span> <span class="n">myVal</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">round</span><span class="p">(</span><span class="n">myVal</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
</code></pre>
</div>

<p>Decode (payload functions):</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
</code></pre>
</div>

<p>Encode (payload functions):</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mf">1.22</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
</code></pre>
</div>

<p>Decode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="kt">float</span> <span class="n">myVal</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">.</span><span class="mo">00</span><span class="p">;</span>
</code></pre>
</div>

<blockquote>
  <p>Note that it uses <code class="highlighter-rouge">100.00</code>, not <code class="highlighter-rouge">100</code>. If both are integers, Arduino/C/C++ will do the math using integers as well, resulting in 1 instead of 1.22.</p>
</blockquote>

<h2 id="how-to-send-multiple-numbers">How to send multiple numbers?</h2>

<p>In a lot of cases you’ll want to send multiple values in a single message. Start off by encoding each individual number to a buffer of bytes and then combine them into a single buffer.</p>

<p>Encode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">byte</span> <span class="n">payloadA</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xF0</span> <span class="p">};</span>
<span class="n">byte</span> <span class="n">payloadB</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">};</span>
<span class="n">byte</span> <span class="n">payloadC</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">};</span>
    
<span class="kt">int</span> <span class="n">sizeofPayloadA</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">payloadA</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sizeofPayloadB</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">payloadB</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sizeofPayloadC</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">payloadC</span><span class="p">);</span>
    
<span class="n">byte</span> <span class="n">payload</span><span class="p">[</span><span class="n">sizeofPayloadA</span> <span class="o">+</span> <span class="n">sizeofPayloadB</span> <span class="o">+</span> <span class="n">sizeofPayloadC</span><span class="p">];</span>
    
<span class="n">memcpy</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">payloadA</span><span class="p">,</span> <span class="n">sizeofPayloadA</span><span class="p">);</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">payload</span> <span class="o">+</span> <span class="n">sizeofPayloadA</span><span class="p">,</span> <span class="n">payloadB</span><span class="p">,</span> <span class="n">sizeofPayloadB</span><span class="p">);</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">payload</span> <span class="o">+</span> <span class="n">sizeofPayloadA</span> <span class="o">+</span> <span class="n">sizeofPayloadB</span><span class="p">,</span> <span class="n">payloadC</span><span class="p">,</span> <span class="n">sizeofPayloadC</span><span class="p">);</span>
</code></pre>
</div>

<blockquote>
  <p>You might wonder why <a href="http://en.cppreference.com/w/c/string/byte/memcpy"><code class="highlighter-rouge">memcpy()</code></a> accepts <code class="highlighter-rouge">payload + sizeOfPayloadA</code> as they seem 🍏 and 🍊. Think of it as an instruction to copy to the <code class="highlighter-rouge">payload</code> buffer, but after moving the point it will copy to with the length of the payloads we added so far.s</p>
</blockquote>

<p>Decode (payload functions)</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">decoded</span><span class="p">.</span><span class="nx">myValA</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">decoded</span><span class="p">.</span><span class="nx">myValB</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="c1">// Decode both byte arrays as we did before</span>
</code></pre>
</div>

<p>Encode (payload function)</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="c1">// Encode both values as we did before</span>

<span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytesA</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">bytesB</span><span class="p">);</span>
</code></pre>
</div>

<p>Decode (Arduino):</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">var</span> <span class="n">payloadA</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">var</span> <span class="n">payloadB</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="n">memcpy</span><span class="p">(</span><span class="n">payloadA</span><span class="p">,</span> 
</code></pre>
</div>

<h2 id="how-to-send-text">How to send text?</h2>

<p>The short answer is: <strong>don’t</strong>. Text uses a lot of bytes. <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> defines more than 128000 characters, so that would take 3 bytes per character! There are rarely good reasons to use text instead of numbers, apart from maybe transmitting some user input.</p>

<p>You didn’t hear it from me, but here’s how you’d encode a string:</p>

<div class="language-c highlighter-rouge">
<pre class="highlight"><code><span class="n">var</span> <span class="n">myVal</span> <span class="o">=</span> <span class="s">"Hello"</span><span class="p">;</span>
<span class="n">var</span> <span class="n">l</span> <span class="o">=</span> <span class="n">myVal</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
<span class="n">byte</span> <span class="n">payload</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="n">myVal</span><span class="p">.</span><span class="n">getBytes</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</code></pre>
</div>

<p>Which you would decode with:</p>

<div class="language-js highlighter-rouge">
<pre class="highlight"><code><span class="nx">decoded</span><span class="p">.</span><span class="nx">myVal</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">);</span>
</code></pre>
</div>

          </div>
        </section>
</div>

  </div>
</div>

<div class="modal fade" id="lightbox" tabindex="-1" role="dialog">
  <div class="modal-dialog text-center" role="document" style="width:auto;padding:20px;">
    <a href="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png"><img class="modal-content modal-body" src="https://ttnstaticfile.blob.core.windows.net/static/ttn/media/logo/ttn-logo.png" alt="Zoom"></a>
  </div>
</div>

    </div>

    <script src="/docs/assets/js/bundle.js"></script><script src="https://www.thethingsnetwork.org/navbar.js"></script><script src="https://ttnstaticfile.blob.core.windows.net/static/common/js/ga.js"></script>
</body>
</html>
